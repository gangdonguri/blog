---
title: '[k8s] ì¿ ë²„ë„¤í‹°ìŠ¤ ì˜¤ë¸Œì íŠ¸ ê´€ë¦¬'
excerpt: "k8s"

categories:
  - k8s
tags: 
  - [k8s]

date: 2023-03-01
last_modified_at: 2023-03-01
---

# ğŸ¯ì¿ ë²„ë„¤í‹°ìŠ¤ ì˜¤ë¸Œì íŠ¸ ê´€ë¦¬ ë°©ë²•
1. Imperative Commands
2. Imperative Object Configuration
3. Declarative Object Configuration

## êµ¬ì„± íŒŒì¼ì„ ì´ìš©í•œ ì„ ì–¸í˜• ê´€ë¦¬
ëª…ë ¹í˜• ë°©ì‹ì—ì„œëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±(create),  ì—…ë°ì´íŠ¸(replace), etc ë™ì‘ì— ë”°ë¼ í•˜ìœ„ ëª…ë ¹ì´ ë‹¬ë¼ì§„ë‹¤. ë°˜ë©´ ì„ ì–¸ì  ë°©ë²•ì—ì„œëŠ” `apply` ëª…ë ¹ í•˜ë‚˜ë¡œ ëª¨ë“  ë™ì‘ì„ ìˆ˜í–‰í•œë‹¤. `apply` ëª…ë ¹ì´ ì–´ë–¤ ë™ì‘ì„ ìˆ˜í–‰í• ì§€ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ìì²´ì ìœ¼ë¡œ íŒë‹¨í•œë‹¤.

```bash
$ kubectl apply -f <ë””ë ‰í† ë¦¬>/
```

### ì˜¤ë¸Œì íŠ¸ ìƒì„±

- ì§€ì •í•œ ë””ë ‰í† ë¦¬ ë‚´ êµ¬ì„± íŒŒì¼ì— ì •ì˜ëœ ëª¨ë“  ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ `kubectl apply` ëª…ë ¹ì„ ì‚¬ìš©í•œë‹¤.
- `kubectl apply` ëª…ë ¹ì„ í†µí•´ ìƒì„±ëœ ì˜¤ë¸Œì íŠ¸ëŠ” `kubectl.kubernetes.io/last-appliced-configuration: '{...}'` ì–´ë…¸í…Œì´ì…˜ì„ ìë™ìœ¼ë¡œ ì„¤ì •í•œë‹¤. 
- í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì€ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì‚¬ìš©í–ˆë˜ ì˜¤ë¸Œì íŠ¸ êµ¬ì„± íŒŒì¼ì˜ ë‚´ìš©ì„ í¬í•¨í•œë‹¤.
- ë‹¤ìŒì€ ì˜ˆì‹œ êµ¬ì„± íŒŒì¼ì— ì˜í•´ ìƒì„±ëœ ì˜¤ë¸Œì íŠ¸ì— ìë™ìœ¼ë¡œ ì„¤ì •ëœ ì–´ë…¸í…Œì´ì…˜ì„ ë³´ì—¬ì¤€ë‹¤.

```yaml
kind: Deployment
metadata:
  annotations:
    # ...
    # This is the json representation of simple_deployment.yaml
    # It was written by kubectl apply when the object was created
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"apps/v1","kind":"Deployment",
      "metadata":{"annotations":{},"name":"nginx-deployment","namespace":"default"},
      "spec":{"minReadySeconds":5,"selector":{"matchLabels":{"app":nginx}},"template":{"metadata":{"labels":{"app":"nginx"}},
      "spec":{"containers":[{"image":"nginx:1.14.2","name":"nginx",
      "ports":[{"containerPort":80}]}]}}}}      
  # ...
```

### ì˜¤ë¸Œì íŠ¸ ì—…ë°ì´íŠ¸
- ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ”ë°ì—ë„ `kubectl apply` ëª…ë ¹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- í™œì„± ì˜¤ë¸Œì íŠ¸ì— ëª…ë ¹í˜• ë°©ì‹ìœ¼ë¡œ ì§ì ‘ ìˆ˜ì •í•œ ë³€ê²½ ì‚¬í•­ì€ `kubectl.kubernetes.io/last-applied-configuration` ì–´ë…¸í…Œì´ì…˜ì— ë°˜ì˜ë˜ì§€ ì•ŠëŠ”ë‹¤.
- êµ¬ì„± íŒŒì¼ì„ ìˆ˜ì •í•˜ê³  `apply` í•œ ê²ƒì— ëŒ€í•´ì„œë§Œ ì–´ë…¸í…Œì´ì…˜ì— ë°˜ì˜ëœë‹¤. 
- ë‹¤ìŒì€ `kubectl scale` ëª…ë ¹ìœ¼ë¡œ í™œì„± ì˜¤ë¸Œì íŠ¸ì¸ `nginx-deployment` ë””í”Œë¡œì´ë¨¼íŠ¸ì— `replicas` í•„ë“œë¥¼ ì§ì ‘ ì—…ë°ì´íŠ¸í•˜ê³  ì–´ë…¸í…Œì´ì…˜ì„ í™•ì¸í•œ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤€ë‹¤.

```yaml
$ kubectl scale deployemnt/nginx-deployment --replicas=2
$ kubectl get deployment nginx-deployment -o yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    # ...
    # note that the annotation does not contain replicas
    # because it was not updated through apply
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"apps/v1","kind":"Deployment",
      "metadata":{"annotations":{},"name":"nginx-deployment","namespace":"default"},
      "spec":{"minReadySeconds":5,"selector":{"matchLabels":{"app":nginx}},"template":{"metadata":{"labels":{"app":"nginx"}},
      "spec":{"containers":[{"image":"nginx:1.14.2","name":"nginx",
      "ports":[{"containerPort":80}]}]}}}}      
  # ...
spec:
  replicas: 2 # written by scale
```

`spec`ì—ì„œ `replicas` í•„ë“œê°€ 2ë¡œ ì„¤ì •ë˜ì—ˆì§€ë§Œ ì–´ë…¸í…Œì´ì…˜ì—ì„œëŠ” replicas í•„ë“œê°€ í¬í•¨ë˜ì§€ ì•Šì•˜ë‹¤.

## applyê°€ ì°¨ì´ë¥¼ ê³„ì‚°í•˜ëŠ” ë°©ë²•
`kubectl apply`ê°€ í•˜ë‚˜ì˜ ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ í™œì„± êµ¬ì„±ì„ ì—…ë°ì´íŠ¸í•  ë•Œ, API ì„œë²„ì— íŒ¨ì¹˜ ìš”ì²­ì„ ë³´ëƒ„ìœ¼ë¡œì¨ ê·¸ê²ƒì„ ìˆ˜í–‰í•œë‹¤. íŒ¨ì¹˜ëŠ” í™œì„± ì˜¤ë¸Œì íŠ¸ êµ¬ì„±ì˜ íŠ¹ì • í•„ë“œì— ëŒ€í•œ ë²”ìœ„ì˜ ì—…ë°ì´íŠ¸ë¡œ í•œì •ëœë‹¤.

`kubectl apply` ì»¤ë§¨ë“œëŠ” êµ¬ì„± íŒŒì¼, í™œì„± êµ¬ì„±, ê·¸ë¦¬ê³  í™œì„± êµ¬ì„±ì— ì €ì¥ëœ `last-applied-configuration` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ íŒ¨ì¹˜ ìš”ì²­ì„ ê³„ì‚°í•œë‹¤. ìƒˆë¡œìš´ í™œì„± êµ¬ì„±ì€ API ì„œë²„ì— ë‹¨ì¼ íŒ¨ì¹˜ ìš”ì²­ìœ¼ë¡œ ë³‘í•©ë˜ê³  ì´ëŠ” etcdì— ì €ì¥ëœë‹¤.

### íŒ¨ì¹˜ ì ˆì°¨
---
1. `last-applied-configuration` ìœ¼ë¡œë¶€í„° ê°’ì„ ì½ì–´ êµ¬ì„± íŒŒì¼ì˜ ê°’ê³¼ ë¹„êµí•œë‹¤. ì–´ë…¸í…Œì´ì…˜ì—ëŠ” ì¡´ì¬í•˜ì§€ë§Œ ë¡œì»¬ êµ¬ì„± íŒŒì¼ì—ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í•„ë“œëŠ” ì‚­ì œ ì¡°ì¹˜ëœë‹¤.
2. ì–´ë…¸í…Œì´ì…˜ì˜ ê°’ê³¼ êµ¬ì„± íŒŒì¼ì˜ ê°’ì´ ë‹¤ë¥¸ í•„ë“œëŠ” êµ¬ì„± íŒŒì¼ì˜ ê°’ìœ¼ë¡œ ë®ì–´ì“°ì—¬ì§€ê³  ë³€ê²½ ì¡°ì¹˜ëœë‹¤.
3. êµ¬ì„± íŒŒì¼ì˜ ê°’ê³¼ ì¼ì¹˜ì‹œí‚¤ê¸° ìœ„í•´ `last-applied-configuration` ì–´ë…¸í…Œì´ì…˜ì„ ì„¤ì •í•œë‹¤.
4. 1,2,3ìœ¼ë¡œë¶€í„°ì˜ ê²°ê³¼ë¥¼ API ì„œë²„ì— ë‹¨ì¼ íŒ¨ì¹˜ ìš”ì²­ìœ¼ë¡œ ë³‘í•©í•œë‹¤.

## ì˜¤ë¸Œì íŠ¸ ê´€ë¦¬ ë°©ë²• ë³€ê²½í•˜ê¸°
ì¿ ë²„ë„¤í‹°ìŠ¤ ì˜¤ë¸Œì íŠ¸ëŠ” í•œ ë²ˆì— ì˜¤ì§ í•˜ë‚˜ì˜ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ê´€ë¦¬ë˜ì–´ì•¼ í•œë‹¤.(ì„ ì–¸í˜• ê´€ë¦¬ì™€ í•¨ê»˜ ëª…ë ¹í˜• ì‚­ì œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ê´œì°®ë‹¤.) ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì „í™˜í•˜ëŠ” ê²ƒì€ ê°€ëŠ¥í•˜ë‚˜, ìˆ˜ë™ í”„ë¡œì„¸ìŠ¤ì´ë‹¤. 

### Imperative Commands => Imperative Object Configuration
1. í™œì„± ì˜¤ë¸Œì íŠ¸ë¥¼ êµ¬ì„± íŒŒì¼ë¡œ ë‚´ë³´ë‚¸ë‹¤.
   ```bash
   $ kubectl get <ì¢…ë¥˜>/<ì´ë¦„> -o yaml > <ì¢…ë¥˜>_<ì´ë¦„>.yaml
   ```
2. êµ¬ì„± íŒŒì¼ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ `status` íŒŒì¼ì„ ì‚­ì œí•œë‹¤.
3. ì˜¤ë¸Œì íŠ¸ì˜ `kubetctl.kubernetes.io/last-applied-configuration` ì–´ë…¸í…Œì´ì…˜ì„ ì„¤ì •í•œë‹¤.
   ```bash
   $ kubectl replace --save-config -f <ì¢…ë¥˜>_<ì´ë¦„>.yaml
   ```
4. ì˜¤ì§ ì˜¤ë¸Œì íŠ¸ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `kubectl apply`ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í”„ë¡œì„¸ìŠ¤ë¥¼ ë³€ê²½í•œë‹¤.

### Imperative Object Configuration => Declarative Object Configuration
1. ì˜¤ë¸Œì íŠ¸ì˜ `kubectl.kubernetes.io/last-applied-configuration` ì–´ë…¸í…Œì´ì…˜ì„ ì„¤ì •í•œë‹¤.
   ```bash
   $ kubectl replace --save-config -f <ì¢…ë¥˜>_<ì´ë¦„>.yaml
   ```
2. ì˜¤ì§ ì˜¤ë¸Œì íŠ¸ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `kubectl apply`ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í”„ë¡œì„¸ìŠ¤ë¥¼ ë³€ê²½í•œë‹¤.

## ğŸ“Œì¶œì²˜
[Kubernetes Docs](https://kubernetes.io/ko/docs/tasks/manage-kubernetes-objects/declarative-config/)

***
    ğŸ‘ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ ì¡°ì–¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}