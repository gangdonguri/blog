---
title: '[docker] docker ë³¼ë¥¨ - Overlay2'
excerpt: "volume"

categories:
  - docker
tags: 
  - [docker]

date: 2023-01-09
last_modified_at: 2023-01-09
---

# ğŸ¯ëª©í‘œ
- overlay2 ë“œë¼ì´ë²„ ì‘ë™ ë°©ì‹
- ì´ë¯¸ì§€ ë° ì»¨í…Œì´ë„ˆ ë ˆì´ì–´

## overlay2 ë“œë¼ì´ë²„ ì‘ë™ ë°©ì‹

![image](https://user-images.githubusercontent.com/87158339/211310388-2c6f1310-31ce-47b5-b857-224352d72584.png)

- `lowerdir`: ì´ë¯¸ì§€ ë ˆì´ì–´
- `upperdir`: ì“°ê¸° ê°€ëŠ¥ ë ˆì´ì–´ (ì»¨í…Œì´ë„ˆ ë ˆì´ì–´)
- `merged`: overlay íŒŒì¼ ì‹œìŠ¤í…œ (Union íŒŒì¼ ì‹œìŠ¤í…œ)

> Note:
>> ë„ì»¤ì—ì„œ ì´ë¯¸ì§€ ë ˆì´ì–´ì™€ ì»¨í…Œì´ë„ˆ ë ˆì´ì–´ê°€ ë™ì¼í•œ íŒŒì¼ì„ í¬í•¨í•˜ëŠ” ê²½ìš° ì»¨í…Œì´ë„ˆ ë ˆì´ì–´ì˜ íŒŒì¼ì´ merged íŒŒì¼ ì‹œìŠ¤í…œì— í¬í•¨ë©ë‹ˆë‹¤.  

### Union íŒŒì¼ ì‹œìŠ¤í…œ íŠ¹ì§•
- Union íŒŒì¼ ì‹œìŠ¤í…œì€ ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ ì‹œìŠ¤í…œì„ í•˜ë‚˜ë¡œ í•©ì³ì„œ ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤.
- Union íŒŒì¼ ì‹œìŠ¤í…œì€ CoWì…ë‹ˆë‹¤. ì½ê¸° ì „ìš©ì— ëŒ€í•œ ì“°ê¸° ë°œìƒ ì‹œ ë³µì‚¬ë³¸ì„ ìƒì„±í•˜ì—¬ ìˆ˜ì •í•©ë‹ˆë‹¤.

## ì´ë¯¸ì§€ ë° ì»¨í…Œì´ë„ˆ ë ˆì´ì–´
```bash
$ ls -l /var/lib/docker/overlay2
drwx--x--- 3 root root     47 Jan  9 12:33 102808657dfeea90ce1d592946d8f363897da5d7181be03d95c0e3e35704fe5e 
drwx--x--- 4 root root     72 Jan  9 12:33 1857fdd0a2ded75dc54c740fb66651283cf151bd50d4520471ae7535a2de940b 
drwx--x--- 4 root root     55 Jan  9 12:33 1dee93b0c934fbcb6d7119dcbe4cb4c55fe57587cddc77c54497f6c3e37b9e9b 
drwx--x--- 4 root root     72 Jan  9 12:33 b8bdb4998a0fb2be7b1261238bfadcf700336f3525da1b8e4035ab8947103271 
drwx--x--- 4 root root     72 Jan  9 12:36 b952dc00632ddb8f08ae8155e1d3b2123b87feec74c21db76f0d7956a33bcd76 
drwx--x--- 4 root root     72 Jan  9 12:33 76dea8a86706871d80b8ab74d92b63e5ab0a5412f2e2d11346923e7b705c7499 
drwx------ 2 root root    210 Jan  9 12:53 l
```

- `1`: ë””ë ‰í„°ë¦¬ì—ëŠ” ê° ì´ë¯¸ì§€ ë ˆì´ì–´ë¥¼ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ì‹ë³„ìê°€ ì‹¬ë³¼ë¦­ ë§í¬ë¡œ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (ì´ë¯¸ì§€ ë ˆì´ì–´ëŠ” ìµœëŒ€ 128ê°œì˜ í•˜ìœ„ ë ˆì´ì–´ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.)

```bash
$ ls /var/lib/docker/overlay2/102808657dfeea90ce1d592946d8f363897da5d7181be03d95c0e3e35704fe5e
diff  link

$ cat /var/lib/docker/overlay2/1857fdd0a2ded75dc54c740fb66651283cf151bd50d4520471ae7535a2de940b/link
K5CJMHXTO64J3BPLLERLLOY4SI

$ ls /var/lib/docker/overlay2/1857fdd0a2ded75dc54c740fb66651283cf151bd50d4520471ae7535a2de940b/diff
bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
```

- ë² ì´ìŠ¤ ì´ë¯¸ì§€ ë ˆì´ì–´ì—ëŠ” `link` íŒŒì¼ê³¼ `diff` ë””ë ‰í„°ë¦¬ê°€ ìˆìŠµë‹ˆë‹¤.
- `link`: ê° ë ˆì´ì–´ì˜ ì‹ë³„ì ì´ë¦„ì´ í¬í•¨ëœ íŒŒì¼
- `diff`: ê° ë ˆì´ì–´ì˜ ì½˜í…ì¸ ê°€ í¬í•¨ëœ ë””ë ‰í„°ë¦¬

```bash
$ ls /var/lib/docker/overlay2/76dea8a86706871d80b8ab74d92b63e5ab0a5412f2e2d11346923e7b705c7499
diff  link  lower  merged  work

$ cat /var/lib/docker/overlay2/76dea8a86706871d80b8ab74d92b63e5ab0a5412f2e2d11346923e7b705c7499/lower
1/V5NFXDAPHXF6SXGC53WZV5S6F2

$ ls /var/lib/docker/overlay2/76dea8a86706871d80b8ab74d92b63e5ab0a5412f2e2d11346923e7b705c7499/diff
etc  run  var
```

- ë² ì´ìŠ¤ ì´ë¯¸ì§€ ë ˆì´ì–´ë¥¼ ì œì™¸í•œ ë ˆì´ì–´ì—ëŠ” `lower` íŒŒì¼ê³¼ `diff`, `work` ë””ë ‰í„°ë¦¬ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- `lower`: ë¶€ëª¨ì˜ ë ˆì´ì–´ ì‹ë³„ìë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- `diff`: í•´ë‹¹ ë ˆì´ì–´ì˜ ì½˜í…ì¸ ê°€ í¬í•¨ëœ ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤.
- `work`: OverlayFS ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë””ë ‰í„°ë¦¬
- ìµœìƒìœ„ ë ˆì´ì–´ì—ëŠ” `merged` ë””ë ‰í„°ë¦¬ê°€ ìˆìŠµë‹ˆë‹¤.
- `merged`: ëª¨ë“  í•˜ìœ„ ë ˆì´ì–´ì™€ ìì‹ ì˜ í†µí•© ì½˜í…ì¸ ë¥¼ í¬í•¨í•˜ëŠ” ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤.

### ë§ˆìš´íŠ¸ í™•ì¸
```bash
# ë°©ë²• 1
$ mount | grep overlay
overlay on /var/lib/docker/overlay2/76dea8a86706871d80b8ab74d92b63e5ab0a5412f2e2d11346923e7b705c7499/merged type overlay (rw,relatime,
lowerdir=/var/lib/docker/overlay2/l/CNAJXREZR2DBWFDJANIJZ5ZQJ7:/var/lib/docker/overlay2/l/2G4XVVPSPZGYGP3V6KN2EIDMQP:/var/lib/docker/overlay2/l/V5NFXDAPHXF6SXGC53WZV5S6F2:/var/lib/docker/overlay2/l/67VROYPCTKPMALRJZIB5NH72UL:/var/lib/docker/overlay2/l/CBWSK4KYN3VQGUAQKOT4SBOGTG:/var/lib/docker/overlay2/l/YDKI4F62HIXJWM3JC2JAW6ERXJ:/var/lib/docker/overlay2/l/5YPHV6STYICUY5QKXJPUJTT6MQ,
upperdir=/var/lib/docker/overlay2/76dea8a86706871d80b8ab74d92b63e5ab0a5412f2e2d11346923e7b705c7499/diff,
workdir=/var/lib/docker/overlay2/76dea8a86706871d80b8ab74d92b63e5ab0a5412f2e2d11346923e7b705c7499/work
```

## ğŸ“Œì¶œì²˜
[Docker Docs](https://docs.docker.com/storage/storagedriver/)

***
    ğŸ‘ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ ì¡°ì–¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}