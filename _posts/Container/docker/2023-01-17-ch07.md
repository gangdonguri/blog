---
title: '[docker-swarm] docker swarm ì‹œì‘í•˜ê¸° (1)'
excerpt: "docker-swarm"

categories:
  - docker
tags: 
  - [docker]

date: 2023-01-17
last_modified_at: 2023-01-17
---

# docker-swarm 
Dockerì˜ í˜„ì¬ ë²„ì „ì—ëŠ” Docker ì—”ì§„ í´ëŸ¬ìŠ¤í„°ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ `swarm`ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

`Swarm`ì€ swarm ëª¨ë“œì—ì„œ ì‹¤í–‰ ë˜ê³  ê´€ë¦¬ì(manager)ì™€ ì‘ì—…ì(worker) ì—­í• ì„ í•˜ëŠ” ì—¬ëŸ¬ Docker í˜¸ìŠ¤íŠ¸ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

## ë…¸ë“œ(node)
ë…¸ë“œëŠ” swarmì— ì°¸ì—¬í•˜ëŠ” Docker ì—”ì§„ì˜ í˜¸ìŠ¤íŠ¸ì´ë©°, ê´€ë¦¬ì ë˜ëŠ” ì‘ì—…ì ë…¸ë“œë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤.
- `ê´€ë¦¬ì(manager)`:
  - task(container)ë¥¼ ì‘ì—…ì ë…¸ë“œì— í• ë‹¹í•©ë‹ˆë‹¤.
  - swarmì´ ì›í•˜ëŠ” ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë° í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
  - ê´€ë¦¬ì ë…¸ë“œëŠ” ë™ì‹œì— ì‘ì—…ì ë…¸ë“œì˜ ì—­í• ë¡œë„ ìˆ˜í–‰í•  ìˆ˜ ìˆì§€ë§Œ ì¼ë°˜ì ìœ¼ë¡œ ê´€ë¦¬ììš© ë…¸ë“œë¡œë§Œ êµ¬ì„±í•©ë‹ˆë‹¤.
- `ì‘ì—…ì(worker)`:
  - ê´€ë¦¬ì ë…¸ë“œì—ì„œ í• ë‹¹í•œ taskë¥¼ ìˆ˜ì‹ í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.
  - ê° ì‘ì—…ì ë…¸ë“œì—ëŠ” í• ë‹¹ëœ task ìƒíƒœë¥¼ ê´€ë¦¬ì ë…¸ë“œì— ë³´ê³ í•˜ê¸° ìœ„í•œ agentê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

## ì„œë¹„ìŠ¤(service) ë° ì‘ì—…(task)
`ì„œë¹„ìŠ¤`ëŠ” ê´€ë¦¬ì ë˜ëŠ” ì‘ì—…ì ë…¸ë“œì—ì„œ ì‹¤í–‰í•  tasksì˜ ì •ì˜ì…ë‹ˆë‹¤.
- `replica`: êµ¬ë™ë˜ê¸¸ ì›í•˜ëŠ” tasksì˜ ìˆ˜ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
- `global`: ì„œë¹„ìŠ¤ì— ëŒ€í•´ ê° ë…¸ë“œì—ì„œ í•˜ë‚˜ì˜ taskë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
- `task`: Docker ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì™€ ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì‹¤í–‰í•  ëª…ë ¹ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

## ë¶€í•˜ ë¶„ì‚°
- Swarm ê´€ë¦¬ìëŠ” ì¸ê·¸ë ˆìŠ¤ ë¡œë“œ ë°¸ëŸ°ì‹±ì„ ì‚¬ìš©í•˜ì—¬ ì™¸ë¶€ì—ì„œ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë…¸ì¶œí•©ë‹ˆë‹¤.
- Swarm ê´€ë¦¬ìëŠ” ë…¸ì¶œë  publishedPortë¥¼ ìë™ìœ¼ë¡œ í• ë‹¹í•˜ê±°ë‚˜ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. publishedPortë¥¼ ì§€ì •í•˜ì§€ ì•ŠëŠ” ê²½ìš° Swarm ê´€ë¦¬ìëŠ” 30000~32767 ë²”ìœ„ì˜ í¬íŠ¸ë¥¼ ì„ì˜ë¡œ í• ë‹¹í•©ë‹ˆë‹¤.
- Swarm ìœ¼ë¡œ êµ¬ì„±ëœ ëª¨ë“  ë…¸ë“œì˜ ì¸ë°”ìš´ë“œ íŠ¸ë˜í”½ì€ ì‹¤í–‰ ì¤‘ì¸ taskë¡œ ë¼ìš°íŒ…ë©ë‹ˆë‹¤.
- Swarm ëª¨ë“œì—ëŠ” ê° ì„œë¹„ìŠ¤ì— ëŒ€í•œ DNS ë ˆì½”ë“œë¥¼ ìë™ìœ¼ë¡œ í• ë‹¹í•˜ëŠ” ë‚´ë¶€ DNS êµ¬ì„± ìš”ì†Œê°€ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ DNS ì´ë¦„ì„ ê¸°ë°˜ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ì„œë¹„ìŠ¤ ê°„ì— ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

## Swarm êµ¬ì„±
- Swarmì˜ ëª¨ë“  ë…¸ë“œëŠ” ê´€ë¦¬ì IP ì£¼ì†Œì— ì—°ê²°í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê´€ë¦¬ì IP ì£¼ì†ŒëŠ” ê³ ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- í˜¸ìŠ¤íŠ¸ ê°„ì˜ í†µì‹ ì„ ìœ„í•´ ë‹¤ìŒ í¬íŠ¸ë¥¼ ê°œë°©í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.
  - í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ í†µì‹ ìš©: `TCP 2377`
  - ë…¸ë“œ ê°„ í†µì‹ ì„ ìœ„í•œ: `TCP ë° UDP 7946`
  - ì˜¤ë²„ë ˆì´ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ìš©: `UDP 4789`
- ë‹¤ìŒ ì ˆì°¨ì— ë”°ë¼ Swarmì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# TODO 1. ê´€ë¦¬ì ë…¸ë“œë¡œ ì‹¤í–‰í•˜ë ¤ëŠ” ë¨¸ì‹ ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ swarmì„ ìƒì„±í•©ë‹ˆë‹¤.
docker swarm init --advertise-addr 192.168.99.100
Swarm initialized: current node (dxn1zf6l61qsb1josjja83ngz) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join \
    --token SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \
    192.168.99.100:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.

# '--advertise-addr': ê´€ë¦¬ì ë…¸ë“œê°€ ê²Œì‹œí•  IP
# '--token': swarmì— ìƒˆ ë…¸ë“œë¥¼ ê²°í•©í•  ë•Œ token ê°’ì— ë”°ë¼ ê´€ë¦¬ì ë˜ëŠ” ì‘ì—…ìë¡œ ì°¸ì—¬í•©ë‹ˆë‹¤.

# TODO 2. 'docker info' ëª…ë ¹ì„ í†µí•´ í˜„ì¬ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
docker info

Containers: 2
Running: 0
Paused: 0
Stopped: 2
  ...snip...
Swarm: active
  NodeID: dxn1zf6l61qsb1josjja83ngz
  Is Manager: true
  Managers: 1
  Nodes: 1
  ...snip...

# TODO 3. 'docker node ls' ëª…ë ¹ì„ í†µí•´ ë…¸ë“œì— ëŒ€í•œ ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
docker node ls

ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS
dxn1zf6l61qsb1josjja83ngz *  manager1  Ready   Active        Leader

# '*': í˜„ì¬ ì—°ê²°ëœ ë…¸ë“œ
# 'dxn1zf6l61qsb1josjja83ngz': ë…¸ë“œ ì´ë¦„ (Docker Swarm ëª¨ë“œëŠ” ì‹œìŠ¤í…œ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì— ëŒ€í•œ ë…¸ë“œ ì´ë¦„ì„ ìë™ìœ¼ë¡œ ì§€ì •)

# TODO 4. worker ë…¸ë“œ ì¶”ê°€: woker ë…¸ë“œë¡œ ì‹¤í–‰í•˜ë ¤ëŠ” ë¨¸ì‹ ë“¤ì—ì„œ ì´ì „ manager ë…¸ë“œì—ì„œ 'docker swarm init' ì¶œë ¥ì—ì„œ ìƒì„±ëœ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
docker swarm join \
  --token  SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c \
  192.168.99.100:2377

This node joined a swarm as a worker.

# TODO 5. ê´€ë¦¬ì ë…¸ë“œì—ì„œ 'docker node ls' ëª…ë ¹ì„ í†µí•´ ì¡°ì¸ëœ ì‘ì—…ì ë…¸ë“œë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
docker node ls
ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS
03g1y59jwfg7cf99w4lt0f662    worker2   Ready   Active
9j68exjopxe7wfl6yuxml7a7j    worker1   Ready   Active
dxn1zf6l61qsb1josjja83ngz *  manager1  Ready   Active        Leader

# MANAGER ì—´ì´ ë¹„ì—¬ìˆëŠ” ê²½ìš° Worker ë…¸ë“œë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.
# 'docker node ls' ëª…ë ¹ì€ ê´€ë¦¬ì ë…¸ë“œì—ì„œë§Œ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.
```

> Note:
>> `docker swarm init` ëª…ë ¹ì˜ ì¶œë ¥ ê²°ê³¼ë¥¼ ìŠì–´ë²„ë¦° ê²½ìš° manager ë…¸ë“œì—ì„œ `docker swarm join-token worker` ëª…ë ¹ìœ¼ë¡œ ë‹¤ì‹œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## Swarmì— ì„œë¹„ìŠ¤ ë°°í¬
```bash
# TODO 1. ê´€ë¦¬ì ë…¸ë“œì—ì„œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
docker service create \
--replicas 1 \
--name helloworld \
alpine \
ping docker.com

9uk4639qpg7npwf3fn2aasksr

# 'docker service create' ëª…ë ¹ì€ ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
# '--name' ì˜µì…˜ì€ ì„œë¹„ìŠ¤ ì´ë¦„ì„ ì§€ì •í•©ë‹ˆë‹¤.
# '--replicas' ì‹¤í–‰ ë  task ê°œìˆ˜ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
# 'alpine' ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
# 'ping docker.com' ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ í•  ëª…ë ¹ì„ ì§€ì •í•©ë‹ˆë‹¤.

# TODO 2. ê´€ë¦¬ì ë…¸ë“œì—ì„œ 'docker service ls' ëª…ë ¹ì„ í†µí•´ ì„œë¹„ìŠ¤ ëª©ë¡ì„ í™•ì¸í•©ë‹ˆë‹¤.
docker service ls

ID            NAME        SCALE  IMAGE   COMMAND
9uk4639qpg7n  helloworld  1/1    alpine  ping docker.com
```

## Swarmì—ì„œ ì„œë¹„ìŠ¤ ê²€ì‚¬
```bash
# TODO 1. ê´€ë¦¬ì ë…¸ë“œì—ì„œ 'docker service inspect --pretty <SERVICE-ID> ëª…ë ¹ì„ í†µí•´ ì½ê¸° ì‰¬ìš´ í˜•ì‹ìœ¼ë¡œ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.
$ docker service inspect --pretty helloworld

ID:		9uk4639qpg7npwf3fn2aasksr
Name:		helloworld
Service Mode:	REPLICATED
 Replicas:		1
Placement:
UpdateConfig:
 Parallelism:	1
ContainerSpec:
 Image:		alpine
 Args:	ping docker.com
Resources:
Endpoint Mode:  vip

# TDOO 2. ê´€ë¦¬ì ë…¸ë“œì—ì„œ 'docker service ps <SERVICE-ID> ëª…ë ¹ì„ í†µí•´ ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
$ docker service ps helloworld

NAME                                    IMAGE   NODE     DESIRED STATE  CURRENT STATE           ERROR               PORTS
helloworld.1.8p1vev3fq5zm0mi8g0as41w35  alpine  worker2  Running        Running 3 minutes

# ì´ ê²½ìš° worker2 ë…¸ë“œì—ì„œ ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.
# Swarmì€ ì„œë¹„ìŠ¤ ì •ì˜ì— ë”°ë¼ ì‘ì—…ì´ ì‹¤í–‰ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ 'DESIRED STATE', 'CURRENT STATE' ì—´ì„ í‘œì‹œí•©ë‹ˆë‹¤.

# TODO 3. ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œì—ì„œ 'docker ps' ëª…ë ¹ì„ í†µí•´ ì‹¤í–‰ ì¤‘ì¸ taskì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
[worker2]$ docker ps

CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
e609dde94e47        alpine:latest       "ping docker.com"   3 minutes ago       Up 3 minutes                            helloworld.1.8p1vev3fq5zm0mi8g0as41w35
```

## Swarmì—ì„œ ì„œë¹„ìŠ¤ í™•ì¥
```bash
# TODO 1. ê´€ë¦¬ì ë…¸ë“œì—ì„œ 'docker service scale <SERVICE-ID>=<NUMBER-OF-TASKS>' ëª…ë ¹ì„ í†µí•´ ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ì˜ ìƒíƒœë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.
docker service scale helloworld=5

helloworld scaled to 5

# TODO 2. ê´€ë¦¬ì ë…¸ë“œì—ì„œ 'docker service ps <SERVICE-ID> ëª…ë ¹ì„ í†µí•´ ì—…ë°ì´íŠ¸ëœ task ëª©ë¡ì„ í™•ì¸í•©ë‹ˆë‹¤.
docker service ps helloworld

NAME                                    IMAGE   NODE      DESIRED STATE  CURRENT STATE
helloworld.1.8p1vev3fq5zm0mi8g0as41w35  alpine  worker2   Running        Running 7 minutes
helloworld.2.c7a7tcdq5s0uk3qr88mf8xco6  alpine  worker1   Running        Running 24 seconds
helloworld.3.6crl09vdcalvtfehfh69ogfb1  alpine  worker1   Running        Running 24 seconds
helloworld.4.auky6trawmdlcne8ad8phb0f1  alpine  manager1  Running        Running 24 seconds
helloworld.5.ba19kca06l18zujfwxyc5lkyn  alpine  worker2   Running        Running 24 seconds

# swarmì´ ì´ 5ê°œì˜ taskë¡œ í™•ì¥í•˜ê¸° ìœ„í•´ 4ê°œì˜ ìƒˆ taskë¥¼ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤.
# taskëŠ” 3ê°œì˜ ë…¸ë“œì— ë¶„ì‚°ë˜ì—ˆê³ , ê·¸ ì¤‘ í•˜ë‚˜ëŠ” manager1 ë…¸ë“œì—ì„œ ì‹¤í–‰ì¤‘ì…ë‹ˆë‹¤.
```

## Swarmì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ ì‚­ì œ
```bash
# TODO 1. ê´€ë¦¬ì ë…¸ë“œì—ì„œ 'docker service rm helloworld' ëª…ë ¹ì„ í†µí•´ ì„œë¹„ìŠ¤ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
docker service rm helloworld

helloworld

# TODO 2. ê´€ë¦¬ì ë…¸ë“œì—ì„œ 'docker service inspect <SERVICE-ID> ëª…ë ¹ì„ í†µí•´ ì„œë¹„ìŠ¤ê°€ ì œê±°ëëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
docker service inspect helloworld
[]
Status: Error: no such service: helloworld, Code: 1
```

> Note:
>> ì„œë¹„ìŠ¤ê°€ ë” ì´ìƒ ì¡´ì¬í•˜ì§€ ì•Šë”ë¼ë„ taskë¥¼ ì •ë¦¬í•˜ëŠ” ë° ëª‡ ì´ˆê°€ ë” ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ“Œì¶œì²˜
[Docker Docs](https://docs.docker.com/engine/swarm/swarm-tutorial/drain-node/)

***
    ğŸ‘ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ ì¡°ì–¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}