---
title: '[docker] docker λ³Όλ¥¨ - volume (1)'
excerpt: "volume"

categories:
  - docker
tags: 
  - [docker]

date: 2023-01-02
last_modified_at: 2023-01-02
---

# Dockerμ—μ„ λ°μ΄ν„° κ΄€λ¦¬
Dockerμ—μ„λ” μ»¨ν…μ΄λ„κ°€ νΈμ¤νΈμ νμΌ μ‹μ¤ν…μ— νμΌμ„ μ €μ¥ν•λ” λ‘ κ°€μ§€ λ§μ΄νΈ μ ν•κ³Ό νΈμ¤νΈμ λ©”λ¨λ¦¬μ— νμΌμ„ μ €μ¥ν•λ” ν• κ°€μ§€ λ§μ΄νΈ μ ν•μ„ μ κ³µν•©λ‹λ‹¤.

- [x] `λ„μ»¤ λ³Όλ¥¨ (λ³Όλ¥¨)` - >Dokcerμ—μ„ κ΄€λ¦¬ν•λ” νΈμ¤νΈ νμΌ μ‹μ¤ν…μ μΌλ¶€μ— λ°μ΄ν„° μ €μ¥ (Linuxμ κ²½μ° `/var/lib/docker/volumes/`)
- [ ] `νΈμ¤νΈ λ³Όλ¥¨ (λ°”μΈλ“ λ§μ΄νΈ)` - νΈμ¤νΈ μ‹μ¤ν…μ μ•„λ¬΄ κ³³μ—λ‚ μ €μ¥
- [ ] `tmpfs` - νΈμ¤νΈ μ‹μ¤ν…μ λ©”λ¨λ¦¬μ—λ§ μ €μ¥, νΈμ¤νΈ μ‹μ¤ν…μ νμΌ μ‹μ¤ν…μ—λ” μ €μ¥ν•μ§€ μ•μ

## λ³Όλ¥¨
λ³Όλ¥¨μ€ Docker μ»¨ν…μ΄λ„μ—μ„ μƒμ„±λκ³  μ‚¬μ©λλ” λ°μ΄ν„°λ¥Ό μ μ§€ν•κΈ° μ„ν•΄ μ„ νΈλλ” λ§¤μ»¤λ‹μ¦μ…λ‹λ‹¤. λ³Όλ¥¨μ€ λ°”μΈλ“ λ§μ΄νΈμ— λΉ„ν•΄ λ‡ κ°€μ§€ μ¥μ μ„ κ°€μ§€κ³  μμµλ‹λ‹¤.
- λ³Όλ¥¨μ€ λ°”μΈλ“ λ§μ΄νΈλ³΄λ‹¤ λ°±μ—… λλ” λ§μ΄κ·Έλ μ΄μ…μ΄ λ” μ‰½μµλ‹λ‹¤.
- Docker CLI λ…λ Ή λλ” Docker APIλ¥Ό μ‚¬μ©ν•μ—¬ λ³Όλ¥¨μ„ κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.
- λ³Όλ¥¨μ€ Linux λ° Windows μ»¨ν…μ΄λ„ λ¨λ‘μ—μ„ μ‘λ™ν•©λ‹λ‹¤.
- μ—¬λ¬ μ»¨ν…μ΄λ„ κ°„μ— λ³Όλ¥¨μ„ λ³΄λ‹¤ μ•μ „ν•κ² κ³µμ ν•  μ μμµλ‹λ‹¤.
- λ³Όλ¥¨ λ“λΌμ΄λ²„λ¥Ό μ‚¬μ©ν•λ©΄ μ›κ²© νΈμ¤νΈ λλ” ν΄λΌμ°λ“ μ κ³µμμ— λ³Όλ¥¨μ„ μ €μ¥ν•κ±°λ‚ λ³Όλ¥¨μ λ‚΄μ©μ„ μ•”νΈν™”ν•κ±°λ‚ λ‹¤λ¥Έ κΈ°λ¥μ„ μ¶”κ°€ν•  μ μμµλ‹λ‹¤.
- μƒ λ³Όλ¥¨μ€ μ»¨ν…μ΄λ„μ— μν•΄ λ―Έλ¦¬ μ±„μ›μ§„ μ½ν…μΈ λ¥Ό κ°€μ§ μ μμµλ‹λ‹¤.

### μƒμ„±
---
λ³Όλ¥¨μ€ μ»¨ν…μ΄λ„μ™€ ν•¨κ» μƒμ„±ν•λ” λ‘ κ°€μ§€ λ°©λ²•μ„ μ κ³µν•©λ‹λ‹¤. `-v` λλ” `--mount` ν”λκ·Έλ¥Ό μ„ νƒν•©λ‹λ‹¤.

- `-v` λλ” `--volume` : μ½λ΅ (:) λ¬Έμλ΅ κµ¬λ¶„λ μ„Έ κ°μ ν•„λ“λ΅ κµ¬μ„±λ©λ‹λ‹¤. ν•„λ“λ” μ¬λ°”λ¥Έ μμ„λ΅ λ‚μ—΄ λμ–΄ μμ–΄μ•Ό ν•©λ‹λ‹¤.
  - μ²« λ²μ§Έ ν•„λ“ : λ³Όλ¥¨μ μ΄λ¦„μ΄λ©° νΈμ¤νΈ μ‹μ¤ν…μ—μ„ κ³ μ ν•΄μ•Ό ν•©λ‹λ‹¤. (μµλ… λ³Όλ¥¨μ κ²½μ° μƒλµν•  μ μμµλ‹λ‹¤.)
  - λ‘ λ²μ§Έ ν•„λ“ : λ³Όλ¥¨μ΄ λ§μ΄νΈλ  μ»¨ν…μ΄λ„μ κ²½λ΅λ¥Ό μλ―Έν•©λ‹λ‹¤.
  - μ„Έ λ²μ§Έ ν•„λ“ : μ‰Όν‘λ΅ κµ¬λ¶„λ λ§μ΄νΈ μµμ… λ©λ΅μ…λ‹λ‹¤. (optional)
- `--mount` <key>=<value> : μ‰Όν‘λ΅ κµ¬λ¶„λ μ—¬λ¬ ν‚¤-κ°’ μμΌλ΅ κµ¬μ„±ν•©λ‹λ‹¤. ν‚¤ μμ„λ” μ¤‘μ”ν•μ§€ μ•μµλ‹λ‹¤.
  - `type` : λ§μ΄νΈμ μ ν•μ„ μ„¤λ…ν•©λ‹λ‹¤. `bind`, `volume`, `tmpfs` μ ν•μ—μ„ μ„ νƒκ°€λ¥ν•λ©°, λ³Όλ¥¨μ κ²½μ° `volume`κ°’μ„ κ°€μ Έμ•Όν•©λ‹λ‹¤.
  - `source` or `src` : λ³Όλ¥¨μ μ΄λ¦„μ„ μλ―Έν•©λ‹λ‹¤ (μµλ… λ³Όλ¥¨μ κ²½μ° μƒλµν•  μ μμµλ‹λ‹¤.)
  - `destination` or `dst` or `target` : λ³Όλ¥¨μ΄ λ§μ΄νΈλ  μ»¨ν…μ΄λ„μ κ²½λ΅λ¥Ό μλ―Έν•©λ‹λ‹¤.
  - `volume-opt` : μµμ… μ΄λ¦„κ³Ό ν•΄λ‹Ή κ°’μΌλ΅ κµ¬μ„±λ ν‚¤-κ°’ μμ„ μ‚¬μ©ν•©λ‹λ‹¤.

#### μ»¨ν…μ΄λ„μ™€ ν•¨κ» λ³Όλ¥¨ μƒμ„±
μ•„μ§ μ΅΄μ¬ν•μ§€ μ•λ” λ³Όλ¥¨μΌλ΅ μ»¨ν…μ΄λ„λ¥Ό μ‹μ‘ν•λ©΄ Dockerκ°€ μλ™μΌλ΅ λ³Όλ¥¨μ„ μƒμ„±ν•©λ‹λ‹¤. λ‹¤μ μμ μ—μ„λ” `-v`μ™€ `--mount` ν”λκ·Έλ¥Ό μ‚¬μ©ν•μ—¬ λ³Όλ¥¨ myvol2μ„ /app/ μ»¨ν…μ΄λ„μ— λ§μ΄νΈν•λ” λ™μΌν• κ²°κ³Όλ¥Ό μ–»μ„ μ μμµλ‹λ‹¤.

```bash
# --mount
docker run -d \
  --name devtest \
  --mount source=myvol2,target=/app \
  nginx:latest

# -v
docker run -d \
  --name devtest \
  -v myvol2:/app \
  nginx:latest
```

#### λ³Όλ¥¨ κ²€μ‚¬
`docker inspect devtext` λ…λ Ήμ€ λ³Όλ¥¨μ΄ μ¬λ°”λ¥΄κ² μƒμ„±λκ³  νƒ‘μ¬λμ—λ”μ§€ ν™•μΈν•λ” λ° μ‚¬μ©ν•©λ‹λ‹¤. `Mounts` μ„Ήμ…μ„ μ°Ύμ•„λ³΄λ©΄ λ§μ΄νΈ μ ν•μ€ `volume` μ΄κ³  μ¬λ°”λ¥Έ μ†μ¤μ™€ λ€μƒμ΄ ν‘μ‹λλ©° λ§μ΄νΈκ°€ μ½κΈ°-μ“°κΈ° κ°€λ¥ν•¨μ„ μ• μμμµλ‹λ‹¤.

```bash
"Mounts": [
    {
        "Type": "volume",
        "Name": "myvol2",
        "Source": "/var/lib/docker/volumes/myvol2/_data",
        "Destination": "/app",
        "Driver": "local",
        "Mode": "",
        "RW": true,
        "Propagation": ""
    }
],
```

#### λ³Όλ¥¨ μ κ±°
μ»¨ν…μ΄λ„λ¥Ό μ¤‘μ§€ν•κ³  λ³Όλ¥¨μ„ μ κ±°ν•©λ‹λ‹¤. λ³Όλ¥¨ μ κ±°λ” λ³„λ„μ λ‹¨κ³„μ…λ‹λ‹¤.

```bash
docker container stop devtest
docker container rm devtest
docker volume rm myvol2
```


### λ³Όλ¥¨ λ‹¨λ…μΌλ΅ κ΄€λ¦¬
---
λ°”μΈλ“ λ§μ΄νΈμ™€ λ‹¬λ¦¬ λ³Όλ¥¨μ€ μ»¨ν…μ΄λ„μ™€ ν•¨κ» μƒμ„±ν•μ§€ μ•κ³  μ»¨ν…μ΄λ„μ™€λ” λ…μμ μΌλ΅ λ³Όλ¥¨μ„ μƒμ„±ν•κ³  κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.

```bash
# λ³Όλ¥¨ λ§λ“¤κΈ°:
docker volume create my-vol

# λ³Όλ¥¨ λ¦¬μ¤ν…:
docker volume ls

# λ³Όλ¥¨ κ²€μ‚¬:
docker volume inspect my-vol

# λ³Όλ¥¨ μ κ±°:
docker volume rm my-vol
```

### μ»¨ν…μ΄λ„ λ°μ΄ν„°λ¥Ό λ³Όλ¥¨μ— λ³µμ 
---
μ»¨ν…μ΄λ„λ¥Ό λ³Όλ¥¨κ³Ό ν•¨κ» μƒμ„±ν•  λ• λ§μ΄νΈν•λ ¤λ” μ»¨ν…μ΄λ„μ νμΌμ‹μ¤ν…μ— νμΌμ΄λ‚ λ””λ ‰ν„°λ¦¬κ°€ μ΄λ―Έ μ΅΄μ¬ν•λ” κ²½μ° ν•΄λ‹Ή νμΌκ³Ό λ””λ ‰ν„°λ¦¬λ” λ³Όλ¥¨μ— λ³µμ‚¬λ©λ‹λ‹¤.

```bash
# --mount
docker run -d \
  --name=nginxtest \
  --mount source=nginx-vol,destination=/usr/share/nginx/html \
  nginx:latest

# -v
docker run -d \
  --name=nginxtest \
  -v nginx-vol:/usr/share/nginx/html \
  nginx:latest
```

μ„ λ…λ Ήμ κ²°κ³Ό μƒλ΅­κ² μƒμ„±λ nginx-vol λ³Όλ¥¨μ—λ” nginx μ»¨ν…μ΄λ„μ /usr/share/nginx/html λ””λ ‰ν„°λ¦¬ λ‚΄ νμΌ λ° λ””λ ‰ν„°λ¦¬κ°€ λ³µμ‚¬λ©λ‹λ‹¤.

### μ½κΈ° μ „μ© λ³Όλ¥¨
---
μ»¨ν…μ΄λ„μ—μ„ λ°μ΄ν„°μ— λ€ν• μ½κΈ° μ•΅μ„Έμ¤λ§ ν•„μ”ν• κ²½μ° λ§μ΄νΈ μµμ…μ— `ro` λ©λ΅μ„ μ¶”κ°€ν•μ—¬ λ””λ ‰ν† λ¦¬λ¥Ό μ½κΈ° μ „μ© λ³Όλ¥¨μΌλ΅ λ§μ΄νΈν•  μ μμµλ‹λ‹¤. 

```bash
# --mount
docker run -d \
  --name=nginxtest \
  --mount source=nginx-vol,destination=/usr/share/nginx/html,readonly \
  nginx:latest

# -v
docker run -d \
  --name=nginxtest \
  -v nginx-vol:/usr/share/nginx/html:ro \
  nginx:latest
```

### λ³Όλ¥¨ λ°±μ—…, λ³µμ›, λ§μ΄κ·Έλ μ΄μ…
λ³Όλ¥¨μ€ λ°±μ—…, λ³µμ› λ° λ§μ΄κ·Έλ μ΄μ…μ— μ μ©ν•©λ‹λ‹¤. `--volumes-from` ν”λκ·Έλ¥Ό μ‚¬μ©ν•μ—¬ ν•΄λ‹Ή λ³Όλ¥¨μ„ νƒ‘μ¬ν•λ” μƒ μ»¨ν…μ΄λ„λ¥Ό λ§λ“­λ‹λ‹¤.

#### λ°±μ—…
1. λ‹¤μκ³Ό κ°™μ€ μƒ μ»¨ν…μ΄λ„λ¥Ό λ§λ“­λ‹λ‹¤.
  ```bash
  docker run -v /dbdata --name dbstore ubuntu /bin/bash
  ```
2. `dbstore` μ»¨ν…μ΄λ„μ `/dbdata` λ””λ ‰ν„°λ¦¬λ¥Ό λ§μ΄νΈν•λ” μƒ μ»¨ν…μ΄λ„λ¥Ό μƒμ„±ν•©λ‹λ‹¤. μ΄λ• μƒ μ»¨ν…μ΄λ„λ” νΈμ¤νΈμ ν„μ¬ λ””λ ‰ν„°λ¦¬λ¥Ό /backup λ””λ ‰ν„°λ¦¬μ— λ§μ΄νΈν•κ³  /dbstore μ»¨ν…μ΄λ„λ¥Ό ν†µν•΄ λ§μ΄νΈν• /dbdata λ””λ ‰ν„°λ¦¬μ λ‚΄μ©μ„ /backup/backup.tar νμΌλ΅ λ¬¶λ” λ…λ Ήμ΄ ν¬ν•¨λ©λ‹λ‹¤.
  ```bash
  docker run --rm --volumes-from dbstore -v $(pwd):/backup ubuntu tar cvf /backup/backup.tar /dbdata
  ```
3. λ…λ Ήμ΄ μ™„λ£λκ³  μ»¨ν…μ΄λ„κ°€ μ¤‘μ§€λλ©΄ `dbdata` λ³Όλ¥¨μ λ°±μ—…μ΄ μƒμ„±λ©λ‹λ‹¤.

#### λ³µμ›
λ°©κΈ μƒμ„±ν• λ°±μ—…μ„ λ™μΌν• μ»¨ν…μ΄λ„ λλ” λ‹¤λ¥Έ κ³³μ—μ„ μƒμ„±ν• λ‹¤λ¥Έ μ»¨ν…μ΄λ„μ— λ³µμ›ν•  μ μμµλ‹λ‹¤.

1. μ΄λ¦„μ΄ `dbstore2`μΈ μƒ μ»¨ν…μ΄λ„λ¥Ό λ§λ“­λ‹λ‹¤.
  ```bash
  docker run -v /dbdata --name dbstore2 ubuntu /bin/bash
  ```
2. μƒ μ»¨ν…μ΄λ„μ λ°μ΄ν„° λ³Όλ¥¨μ—μ„ λ°±μ—… νμΌμ μ••μ¶•μ„ ν’‰λ‹λ‹¤.
  ```bash
  docker run --rm --volumes-from dbstore2 -v $(pwd):/backup ubuntu bash -c "cd /dbdata && tar xvf /backup/backup.tar --strip 1"
  ```

### λ³Όλ¥¨ μ κ±°
---
Docker λ°μ΄ν„° λ³Όλ¥¨μ€ μ»¨ν…μ΄λ„λ¥Ό μ‚­μ ν• ν›„μ—λ„ μ μ§€λ©λ‹λ‹¤. κ³ λ ¤ν•΄μ•Ό ν•  λ‘ κ°€μ§€ μ ν•μ λ³Όλ¥¨μ΄ μμµλ‹λ‹¤.
- μµλ… λ³Όλ¥¨
- μ΄λ¦„μ΄ μλ” λ³Όλ¥¨

#### μµλ… λ³Όλ¥¨ μλ™ μ κ±°
μµλ… λ³Όλ¥¨μ„ μλ™μΌλ΅ μ κ±°ν•λ ¤λ©΄ `--rm` μµμ…μ„ μ‚¬μ©ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄ μ•„λμ λ…λ Ήμ€ μµλ… `/foo` λ³Όλ¥¨μ„ μƒμ„±ν•©λ‹λ‹¤. μ»¨ν…μ΄λ„λ¥Ό μ κ±°ν•λ©΄ Docker μ—”μ§„μ΄ `/foo` λ³Όλ¥¨μ„ μ κ±°ν•μ§€λ§ `awesome` λ³Όλ¥¨μ€ μ κ±°ν•μ§€ μ•μµλ‹λ‹¤.

```bash
docker run --rm -v /foo -v awesome:/bar busybox top
```

#### λ¨λ“  λ³Όλ¥¨ μ κ±°
μ‚¬μ©ν•μ§€ μ•λ” λ¨λ“  λ³Όλ¥¨μ„ μ κ±°ν•κ³  κ³µκ°„μ„ ν™•λ³΄ν•λ ¤λ©΄ λ‹¤μμ λ…λ Ήμ„ μ‚¬μ©ν•©λ‹λ‹¤.

```bash
docker volume prune
```

## π“μ¶μ²
[Docker Docs](https://docs.docker.com/storage/volumes/)

***
    π‘ κ°μΈ κ³µλ¶€ κΈ°λ΅μ© λΈ”λ΅κ·Έμ…λ‹λ‹¤. μ¤λ¥λ‚ μ΅°μ–Έμ΄ μμΌμ‹λ©΄ μ–Έμ λ“ μ§€ λ“κΈ€ νΉμ€ λ©”μΌλ΅ λ‚¨κ²¨μ£Όμ‹λ©΄ κ°μ‚¬ν•κ² μµλ‹λ‹¤! π„

[λ§¨ μ„λ΅ μ΄λ™ν•κΈ°](#){: .btn .btn--primary }{: .align-right}