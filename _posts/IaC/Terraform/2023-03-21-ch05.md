---
title: '[Terraform] template_file ë°ì´í„° ì†ŒìŠ¤'
excerpt: "terraform"

categories:
  - terraform
tags: 
  - [terraform]

date: 2023-03-21
last_modified_at: 2023-03-21
---

# ğŸ¯template_file ë°ì´í„° ì†ŒìŠ¤
ì¼ë°˜ì ìœ¼ë¡œ í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´(ë°°ì‹œ)ë¥¼ ë‹¤ë¥¸ í”„ë¡œê·¸ë˜ë° ì–¸ì–´(í…Œë¼í¼)ì— í¬í•¨í•˜ë©´ ê°ê°ì˜ ì–¸ì–´ë¥¼ ìœ ì§€í•˜ê¸°ê°€ ë” ì–´ë ¤ì›Œì§€ë¯€ë¡œ ë°°ì‹œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì™¸ë¶€í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë‚´ì¥ í•¨ìˆ˜
í…Œë¼í¼ì—ëŠ” í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ë‚´ì¥ í•¨ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ file í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•©ë‹ˆë‹¤.

```bash
file(<PATH>)
```

ì´ í•¨ìˆ˜ëŠ” `PATH`ì—ì„œ íŒŒì¼ì„ ì½ê³  ê·¸ ë‚´ìš©ì„ ë¬¸ìì—´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì‚¬ìš©ì ë°ì´í„° ìŠ¤í¬ë¦½íŠ¸ë¥¼ `user-data.sh` íŒŒì¼ì— ë„£ê³  ë‹¤ìŒê³¼ ê°™ì´ ë¬¸ìì—´ë¡œ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
file("user-data.sh")
```

## template_file
ê·¸ëŸ°ë° `user-data.sh` ìŠ¤í¬ë¦½íŠ¸ì— ë°ì´í„°ë² ì´ìŠ¤ì˜ ì£¼ì†Œ ë° í¬íŠ¸ë¥¼ terraform_remote_state ë°ì´í„° ì†ŒìŠ¤ë¥¼ í†µí•´ ë™ì ì¸ ë°ì´í„°ë¥¼ ìš”êµ¬í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. 
```bash
#!/bin/bash
echo "Hello, World!"" >> index.html
echo "${data.terraform_remote_state.db.outputs.address}" >> index.html
echo "${data.terraform_remote_state.db.outputs.port}" >> index.html
nohup busybox httpd -f -p ${var.server_port} &
```

í…Œë¼í¼ì—ì„œ file í•¨ìˆ˜ëŠ” í…Œë¼í¼ ì½”ë“œë¥¼ ì°¸ì¡°ì™€ ë³´ê°„ì„ ì´ìš©í•˜ì—¬ ê°’ì„ ì±„ìš¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `template_file` ë°ì´í„° ì†ŒìŠ¤ëŠ” ìš°ë¦¬ì—ê²Œ í•´ê²°ì±…ì„ ì œì‹œí•´ì¤ë‹ˆë‹¤.

template_file ë°ì´í„° ì†ŒìŠ¤ì—ëŠ” 2ê°œì˜ ì¸ìˆ˜, ì¦‰ ë Œë”ë§í•  ë¬¸ìì—´ì¸ templateê³¼ ë Œë”ë§ ì¤‘ì— ì‚¬ìš©í•  ë³€ìˆ˜ì˜ ë§µì¸ varsê°€ ìˆìŠµë‹ˆë‹¤. varsì—ëŠ” renderedë¼ëŠ” ì¶œë ¥ ì†ì„±ì´ ìˆëŠ”ë° ì´ëŠ” ë Œë”ë§ templateì˜ ê²°ê³¼ì…ë‹ˆë‹¤. 

```json
data "template_file" "user_data" {
  template = file("user-data.sh")

  vars = {
    server_port = var.server_port
    db_address  = data.terraform_remote_state.db.outputs.address
    db_port     = data.terraform_remote_state.db.outputs.port
  }
}
```

vars ë§¤ê°œ ë³€ìˆ˜ëŠ” ì‚¬ìš©ì ë°ì´í„° ìŠ¤í¬ë¦½íŠ¸ì— í•„ìš”í•œ 3ê°€ì§€ ë³€ìˆ˜, ì¦‰ ì„œë²„ í¬íŠ¸, ë°ì´í„°ë² ì´ìŠ¤ ì£¼ì†Œ ë° ë°ì´í„°ë² ì´ìŠ¤ í¬íŠ¸ì— ëŒ€í•œ ë³€ìˆ˜ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ `user-data.sh` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.

```bash
#!/bin/bash

cat > index.html <<EOF
<h1>Hello, World</h1>
<p>DB address: ${db_address}</p>
<p>DB port: ${db_port}</p>
EOF

nohub busybox httpd -f -p ${server_port} &
```

- í…Œë¼í¼ì˜ í‘œì¤€ ë³´ê°„ êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ë¥¼ ì¡°íšŒí•˜ì§€ë§Œ template_file ë°ì´í„° ì†ŒìŠ¤ì˜ vars ë§µì— ìˆëŠ” ë³€ìˆ˜ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë³€ìˆ˜ì— ì—‘ì„¸ìŠ¤í•˜ëŠ” ë°ëŠ” ì ‘ë‘ì‚¬ê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ var.server_portê°€ ì•„ë‹Œ server_portë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.
- ìŠ¤í¬ë¦½íŠ¸ì—ëŠ” ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ê²°ê´ê°’ì„ ì¢€ ë” ì½ê¸° ì‰½ê²Œ í•˜ê¸° ìœ„í•´ <h1>ê³¼ ê°™ì€ HTML êµ¬ë¬¸ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### template_file ë°ì´í„° ì†ŒìŠ¤ì˜ rendered ì¶œë ¥ ì†ì„±
ë§ˆì§€ë§‰ìœ¼ë¡œ user_data ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì—ì„œ template_file ë°ì´í„° ì†ŒìŠ¤ì˜ rendered ì¶œë ¥ ì†ì„±ì„ ê°€ë¦¬í‚¤ë„ë¡ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ë‹¤ìŒ ì˜ˆì œì—ì„œëŠ” aws_launch_configuration ë¦¬ì†ŒìŠ¤ì˜ user_data ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

```json
resouce "aws_launch_configuration" "example" {
  image_id        = "ami-0c55b159bfafe1f0"
  instance_type   = "t2.micro"
  security_groups = [aws_security_group.instance.id]
  user_data       = data.template_file.user_data.rendered

  lifecycle {
    create_before_destroy = true
  }
}
```

## ğŸ“Œì¶œì²˜
[Terraform Up & Running](https://developer.hashicorp.com/terraform/language/modules/develop)

***
    ğŸ‘ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ ì¡°ì–¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}