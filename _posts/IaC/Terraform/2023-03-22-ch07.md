---
title: '[Terraform] ëª¨ë“ˆê³¼ ì§€ì—­ ë³€ìˆ˜'
excerpt: "terraform"

categories:
  - terraform
tags: 
  - [terraform]

date: 2023-03-22
last_modified_at: 2023-03-22
---

# ğŸ¯ëª¨ë“ˆê³¼ ì§€ì—­ ë³€ìˆ˜
ì…ë ¥ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“ˆì˜ ì…ë ¥ì„ ì •ì˜í•˜ëŠ” ê²ƒë„ ì¢‹ì§€ë§Œ ì¤‘ê°„ì— ê³„ì‚°ì„ ìˆ˜í–‰í•˜ê±°ë‚˜ ì½”ë“œê°€ ì¤‘ë³µë˜ì§€ ì•Šê²Œë” ëª¨ë“ˆì—ì„œ ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” ë°©ë²•ì´ í•„ìš”í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ í•´ë‹¹ ë³€ìˆ˜ë¥¼ ì…ë ¥ìœ¼ë¡œ ë…¸ì¶œí•˜ì§€ ì•Šìœ¼ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?

## locals ë¸”ë¡
ì˜ˆë¥¼ ë“¤ì–´, modules/services/webserver-cluster/main.tfì˜ webserver-cluster ëª¨ë“ˆì— ìˆëŠ” ë¡œë“œ ë°¸ëŸ°ì„œëŠ” HTTPì˜ ê¸°ë³¸ í¬íŠ¸ì¸ 80 í¬íŠ¸ë¡œ ë¦¬ìŠ¤ë‹í•©ë‹ˆë‹¤. ì´ í¬íŠ¸ ë²ˆí˜¸ëŠ” í˜„ì¬ ë¡œë“œ ë°¸ëŸ°ì„œ ë¦¬ìŠ¤ë„ˆë¥¼ í¬í•¨í•˜ì—¬ ì—¬ëŸ¬ ê³³ì— í•˜ë“œ ì½”ë”©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```json
resource "aws_lb_listener" "http" {
  load_balancer_arn = aws_lb.example.arn
  port              = 80
  protocol          = "HTTP"

  default_action {
    type = "fixed-response"

    fixed response {
      content_type = "text/plain"
      message_body = "404: page not found"
      status_code  = 404
    }
  }
}

resource "aws_security_group" "alb" {
  name = "${var.cluster_name}-alb"

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}
```

`aws_security_group` ë¦¬ì†ŒìŠ¤ì—ëŠ” CIDR ë¸”ë¡ê³¼ í¬íŠ¸, í”„ë¡œí† ì½œì„ ì˜ë¯¸í•˜ëŠ” ê°’ì´ ëª¨ë‘ í•˜ë“œ ì½”ë”©ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê°’ì„ ì—¬ëŸ¬ ê³³ì— í•˜ë“œ ì½”ë”©í•˜ì—¬ ì ìš©í•˜ë©´ ì½”ë“œë¥¼ ì½ê³  ìœ ì§€í•˜ê¸°ê°€ ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤. ì…ë ¥ ë³€ìˆ˜ë¡œ ê°’ì„ ì¶”ì¶œí•  ìˆ˜ë„ ìˆì§€ë§Œ ì´ ê²½ìš°ì—ëŠ” `locals ë¸”ë¡`ì—ì„œ ë¡œì»¬ ê°’ìœ¼ë¡œ ì •ì˜í•˜ë©´ ë©ë‹ˆë‹¤.

```json
locals {
  http_port    = 80
  any_port     = 0
  any_protocol = "-1"
  tcp_protocol = "tcp"
  all_ips      = ["0.0.0.0/0"]
}
```

ë¡œì»¬ ê°’ì€ ëª¨ë“ˆ ì „ì²´ì—ì„œ í•´ë‹¹ ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì´ë¦„ì€ ëª¨ë“ˆ ë‚´ì—ì„œë§Œ í‘œì‹œë˜ë¯€ë¡œ ë‹¤ë¥¸ ëª¨ë“ˆì—ëŠ” ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šìœ¼ë©°, ëª¨ë“ˆ ì™¸ë¶€ì—ì„œ ì´ ê°’ì„ ì¬ì •ì˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¡œì»¬ ê°’ì„ ì½ìœ¼ë ¤ë©´ ë‹¤ìŒ êµ¬ë¬¸ìœ¼ë¡œ ëœ ë¡œì»¬ ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```json
local.<NAME>
```

ì´ êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ë¡œë“œ ë°¸ëŸ°ì„œì˜ ë¦¬ìŠ¤ë„ˆì™€ ë³´ì•ˆ ê·¸ë£¹ì„ ì—…ë°ì´íŠ¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```json
resource "aws_lb_listener" "http" {
  load_balancer_arn = aws_lb.example.arn
  port              = local.http_port
  protocol          = "HTTP"

  default_action {
    type = "fixed-response"

    fixed response {
      content_type = "text/plain"
      message_body = "404: page not found"
      status_code  = 404
    }
  }
}

resource "aws_security_group" "alb" {
  name = "${var.cluster_name}-alb"

  ingress {
    from_port   = local.http_port
    to_port     = local.http_port
    protocol    = local.tcp.protocol
    cidr_blocks = local.all_ips
  }

  egress {
    from_port   = local.any_port
    to_port     = local.any_port
    protocol    = local.any_protocol
    cidr_blocks = local.all_ips
  }
}
```

## ğŸ“Œì¶œì²˜
[Terraform Up & Running](https://developer.hashicorp.com/terraform/language/modules/develop)

***
    ğŸ‘ ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ì˜¤ë¥˜ë‚˜ ì¡°ì–¸ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ëŒ“ê¸€ í˜¹ì€ ë©”ì¼ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸ˜„

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}