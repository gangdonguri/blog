---
title: '[Project] Code-States DevOps Bootcamp Project2'
excerpt: "Project2 회고"

categories:
  - Project
tags: 
  - [Project]

date: 2023-01-25
last_modified_at: 2023-01-25
---

# Project2
<details>
<summary>Day 1</summary>
<div markdown="1">       

- [x] 마일스톤1 - Hello World 서버 컨테이너화
- [x] 마일스톤2 - docker-compose 작성
- [x] 마일스톤3 - 이미지 repository push 자동화

</div>
</details>
<details>
<summary>Day 2</summary>
<div markdown="1">       

- [x] 마일스톤4 - 이미지 ECS 배포
- [x] 마일스톤5 - 서버 이미지 ECS 배포 자동화
- [x] 마일스톤6 - 서버 애플리케이션의 HTTPS 적용

</div>
</details>
<details>
<summary>Day 3</summary>
<div markdown="1">       

- [x] 마일스톤7 - 프론트엔드 배포 자동화
- [x] 마일스톤8 - 프론트엔드 HTTPS 적용
- [x] 마일스톤9 - 프론트엔드-서버 연결 확인

</div>
</details>
<details>
<summary>Day 4</summary>
<div markdown="1">       

- [ ] 마일스톤10 - 서버 애플리케이션 CRUD 구현

</div>
</details>

## 마일스톤1 - Hello World 서버 컨테이너화
<details>
<summary>1. was 서버 도커 이미지 빌드</summary>
<div markdown="1">       

```bash
# TODO 1. fastify-cli 설치
$ npm i --global fastify-cli

# TODO 2. node v16.19.0 설치
$ nvm install v16.19.0

# TODO 3. default 노드 버전 설정
$ nvm alias default v16.19.0

# TODO 4. fastify helloworld-was 프로젝트 생성
$ fastify generate helloworld-was

# TODO 5. npm start listen ip 변경
$ cd helloworld-was/
$ vim package.json
{
  "name": "helloworld-was",
  "version": "1.0.0",
  "description": "This project was bootstrapped with Fastify-CLI.",   
  "main": "app.js",
  "directories": {
    "test": "test"
  },
  "scripts": {
    "test": "tap \"test/**/*.test.js\"",
    "start": "fastify start -l info app.js --address 0.0.0.0",        
    "dev": "fastify start -w -l info -P app.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "fastify": "^4.0.0",
    "fastify-plugin": "^4.0.0",
    "@fastify/autoload": "^5.0.0",
    "@fastify/sensible": "^5.0.0",
    "fastify-cli": "^5.7.1"
  },
  "devDependencies": {
    "tap": "^16.1.0"
  }
}

# TODO 6. .dockerignore 파일 추가
$ vim .dockerignore
node_modules

# TODO 7. Dockerfile 추가
$ vim Dockerfile
FROM node:16-alpine

WORKDIR /app
COPY ["package.json", "package-lock.json*", "./"]
RUN npm install

ENV NODE_ENV production
EXPOSE 3000

COPY . .
CMD ["npm", "start"]

# TODO 8. docker 이미지 빌드
$ docker build -t helloworld-was:1.0 .

# TODO 9. 빌드한 이미지 AWS ECR에 푸시 (aws cli 설치 및 credential 등록 필요)
$ aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin 901512289056.dkr.ecr.ap-northeast-2.amazonaws.com
$ docker tag helloworld-was:1.0 901512289056.dkr.ecr.ap-northeast-2.amazonaws.com/helloworld-was:1.0
$ docker push 901512289056.dkr.ecr.ap-northeast-2.amazonaws.com/helloworld-was:1.0
```

</div>
</details>

## 마일스톤2 - docker-compose 작성
<details>
<summary>1. docker-compose를 이용해 was와 mongodb 한번에 띄우기</summary>
<div markdown="1">       

```bash
# TODO 1. @fastify/mongodb 의존성 설치
$ vim package.json
{
  "name": "helloworld-was",
  "version": "1.0.0",
  "description": "This project was bootstrapped with Fastify-CLI.",   
  "main": "app.js",
  "directories": {
    "test": "test"
  },
  "scripts": {
    "test": "tap \"test/**/*.test.js\"",
    "start": "fastify start -l info app.js --address 0.0.0.0",        
    "dev": "fastify start -w -l info -P app.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "fastify": "^4.0.0",
    "fastify-plugin": "^4.0.0",
    "@fastify/autoload": "^5.0.0",
    "@fastify/sensible": "^5.0.0",
    "@fastify/mongodb": "^6.2.0",
    "fastify-cli": "^5.7.1"
  },
  "devDependencies": {
    "tap": "^16.1.0"
  }
}

# TODO 2. .env 파일 추가
MONGO_USERNAME="root"
MONGO_PASSWORD="example"
MONGO_HOSTNAME="mongo"

# TODO 3. mongodb.js 파일 추가
$ vim plugins/mongodb.js
'use strict'

const fp = require('fastify-plugin')

const { MONGO_HOSTNAME, MONGO_USERNAME, MONGO_PASSWORD } = process.env

module.exports = fp(async function (fastify, opts) {
  const url = `mongodb://${MONGO_USERNAME}:${MONGO_PASSWORD}@${MONGO_HOSTNAME}:27017/?authMechanism=DEFAULT`
  console.log(url)

  fastify.register(require('@fastify/mongodb'), {
    forceClose: true,
    url: url
  })

  console.log('플러그인 등록에 성공하였습니다.')
})

# TODO 4. was 이미지 빌드
$ docker build -t helloworld-was:1.1 .

# TODO 5. docker-compose 파일 추가
$ vim docker-compose.yml
version: '3.1'

services:
  was:
    image: helloworld-was:1.1
    restart: always
    ports:
      - 8080:3000
    depends_on:
      - mongo

  mongo:
    image: mongo:4.4
    restart: always
    ports:
      - 27017:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example

# TODO 6. helloworld-was와 mongodb 한번에 실행
$ docker-compose up -d
```

</div>
</details>


## 마일스톤3 - 이미지 repository push 자동화
<details>
<summary>1. github secret 생성</summary>
<div markdown="1">       
  
**1️⃣ github repository 접속**

![image](https://user-images.githubusercontent.com/87158339/214455715-fa3101ba-45e9-4c0a-a5a6-9509ee2b764c.png){: width="700" height="500"}
  
**2️⃣ Settings 클릭**

![image](https://user-images.githubusercontent.com/87158339/214455848-f6cfbba9-d879-4425-a35b-505302982e08.png){: width="700" height="500"}
  
**3️⃣ Secrets and variables -> Actions 클릭**

![image](https://user-images.githubusercontent.com/87158339/214455971-51d420d6-708a-4534-9d24-6f7552874b22.png){: width="700" height="600"}
  
**4️⃣ AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY 이름으로 Secret 생성**

![image](https://user-images.githubusercontent.com/87158339/214456182-4ab9578d-ced1-477e-8477-f12284eba9e8.png){: width="700" heigth="600}

</div>
</details>

<details>
<summary>2. workflow 작성</summary>
<div markdown="1">       

**1️⃣ workflow 작성**
  
```yml
name: Docker Image CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:

  build_push:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3
      
    - name: Extrack version name
      id: extrack_version_name
      run: echo "##[set-output name=version;]$(echo '${{ github.event.head_commit.message }}' | egrep -o '[0-9]{1}\.[0-9]{1}')"

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ap-northeast-2

    - name: Login to Amazon ECR
      id: login-ecr
      uses: aws-actions/amazon-ecr-login@v1

    - name: Build, tag, and push docker image to Amazon ECR
      env: 
        REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        REPOSITORY: helloworld-was
        IMAGE_TAG: ${{ steps.extrack_version_name.outputs.version }}
      run: |
        docker build -t $REGISTRY/$REPOSITORY:$IMAGE_TAG .
        docker push $REGISTRY/$REPOSITORY:$IMAGE_TAG
```
  
**2️⃣ 이미지 푸시**
```bash
$ git add .
$ git commit -m "v1.2"
$ git push myrepo main
```

</div>
</details>

## 마일스톤4 - 이미지 ECS 배포
<details>
<summary>1. 서버 이미지 ECS 배포</summary>
<div markdown="1">       

**1️⃣ 클러스터 생성**

![image](https://user-images.githubusercontent.com/87158339/214461572-3d0ae7bf-af6a-4f43-81ad-89da2da34bc1.png){: width="700" heigth="700"}

**2️⃣ 테스크 정의**

![image](https://user-images.githubusercontent.com/87158339/214462968-afa74715-c428-4298-984c-cfb5061ad592.png){: width="700" heigth="700}
  
![image](https://user-images.githubusercontent.com/87158339/214462863-14d1a61a-f38a-4c22-8165-672c68f04ad5.png){: width="700" heigth="700"}

**3️⃣ 서비스 생성**
  
![image](https://user-images.githubusercontent.com/87158339/214463343-c308d7ef-7283-45e0-85bc-0768335bc23d.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214463409-0e820e6b-43c4-449c-82f4-ba597138cfa4.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214463484-46086d94-33dd-4000-8bf0-b58ed9c73e3b.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214463591-13f6c7d7-8ee7-4c56-a84a-bef53d91d6fa.png){:width="700" heigth="700"}


</div>
</details>

<details>
<summary>2. mongodb 이미지 ECS 배포</summary>
<div markdown="1">       

**1️⃣ 클러스터 생성**
  
![image](https://user-images.githubusercontent.com/87158339/214464292-d18fa68c-4caf-4695-b451-a686e8800e61.png){:width="700" heigth="700"}

**2️⃣ mongo 리포지토리 생성**
  
![image](https://user-images.githubusercontent.com/87158339/214465625-e65a32a0-1fc3-431f-93ac-51f60a7df96b.png){:width="700" heigth="700"}

**3️⃣ mongo 이미지 푸시**

```bash
$ aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin 901512289056.dkr.ecr.ap-northeast-2.amazonaws.com
$ docker pull docker.io/mongo:4.4
$ docker tag mongo:4.4 901512289056.dkr.ecr.ap-northeast-2.amazonaws.com/helloworld-mongo:4.4
$ docker push 901512289056.dkr.ecr.ap-northeast-2.amazonaws.com/helloworld-mongo:4.4
```

**4️⃣ 보안암호 추가**
  
![image](https://user-images.githubusercontent.com/87158339/214467163-408a553f-09c7-4d8b-ad4c-6a4c006ab80e.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214467298-79b23a08-cb2e-4220-8d98-be0009b866fa.png){:width="700" heigth="700"}

**5️⃣ 테스크 정의**
  
![image](https://user-images.githubusercontent.com/87158339/214467657-8bfbe1eb-66c9-46ec-be15-c553db62fc19.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214470529-da97a07b-1325-477d-a146-6b3644f91e7f.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214467861-1cd056a8-afc6-403d-b1ff-bb8bfcbc88e2.png){:width="700" heigth="700"}

**6️⃣ nlb 생성**
  
![image](https://user-images.githubusercontent.com/87158339/214468541-7ccf9b69-8fac-4218-9ae5-246322b04d94.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214468648-c76f3ce3-1f8d-42ff-91ff-2d246963e3f9.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214468783-d3af1184-7316-4dfa-98cd-d7215317a9a2.png){:width="700" heigth="700"}

**7️⃣ 서비스 생성**
  
![image](https://user-images.githubusercontent.com/87158339/214468864-9cd6cd8e-3e75-45ca-92df-fc67370a82ae.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214468933-80163dcc-1954-477c-a68e-ef6264d03eea.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214468991-271cda7d-ad7c-40b9-912b-90145a656125.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214469063-6f4b6b0a-f22e-4bec-9014-14b02bb21895.png){:width="700" heigth="700"}

</div>
</details>

## 마일스톤5 - 서버 이미지 ECS 배포 자동화
<details>
<summary>1. WAS 소스코드 수정</summary>
<div markdown="1">       

```bash
$ vim .env
MONGO_USERNAME="root"
MONGO_PASSWORD="example"
MONGO_HOSTNAME="helloworld-mongo-nlb-7f8ae9ef38792a71.elb.ap-northeast-2.amazonaws.com"

$ vim routes/example/index.js
module.exports = async function (fastify, opts) {
  fastify.post('/', async function (request, reply) {
    const test = this.mongo.client.db('test')
    const article = test.collection('article')
    await article.insertOne({ 'title': '안녕 세상아' })

    const result = await article.find({}).toArray();

    reply.send(result)
  })
}

$ vim routes/root.js
'use strict'

module.exports = async function (fastify, opts) {
  fastify.get('/', async function (request, reply) {
    console.log(process.env.MONGO_HOSTNAME)
    console.log(process.env.MONGO_USERNAME)
    return { root: true, host: process.env.MONGO_HOSTNAME, username: process.env.MONGO_USERNAME }
  })
}

$ git add .
$ git commit -m "v1.3"
$ git push myrepo main
```

</div>
</details>

<details>
<summary>2. 새 개정 생성</summary>
<div markdown="1">       

**1️⃣ 보안암호 생성**
  
![image](https://user-images.githubusercontent.com/87158339/214471356-7d45f901-d247-4f72-bf8e-c3cecd9d84ae.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214471465-7340993f-4c00-42a9-a4bf-f816cbebcc0a.png){:width="700" heigth="700"}

**2️⃣ 새 개정 생성**
  
![image](https://user-images.githubusercontent.com/87158339/214473942-5f8d98de-e27a-4cae-9094-3689cefab8de.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214474105-8020d68f-a2e5-4bd7-a5a0-a226e520bb97.png){:width="700" heigth="700"}

**3️⃣ 서비스 업데이트**
  
![image](https://user-images.githubusercontent.com/87158339/214474487-e8cbadd5-48b1-4f72-a9be-dcd4c15619a8.png){:width="700" heigth="700"}

</div>
</details>

<details>
<summary>3. 서버 배포 자동화</summary>
<div markdown="1">       

**1️⃣ 작업 정의 JSON 파일을 Git repository에 추가**
  
```json
$ vim .aws/task-definition.json
{
    "taskDefinitionArn": "arn:aws:ecs:ap-northeast-2:901512289056:task-definition/helloworld-was-td:2",
    "containerDefinitions": [
        {
            "name": "helloworld-was-container",
            "image": "901512289056.dkr.ecr.ap-northeast-2.amazonaws.com/helloworld-was:1.1",
            "cpu": 0,
            "portMappings": [
                {
                    "name": "helloworld-was-container-3000-tcp",
                    "containerPort": 3000,
                    "hostPort": 3000,
                    "protocol": "tcp",
                    "appProtocol": "http"
                }
            ],
            "essential": true,
            "environment": [],
            "environmentFiles": [],
            "mountPoints": [],
            "volumesFrom": [],
            "secrets": [
                {
                    "name": "MONGO_HOSTNAME",
                    "valueFrom": "arn:aws:secretsmanager:ap-northeast-2:901512289056:secret:prod/AppBeta/mongo-VTqmA0:MONGO_HOSTNAME::"
                },
                {
                    "name": "MONGO_USERNAME",
                    "valueFrom": "arn:aws:secretsmanager:ap-northeast-2:901512289056:secret:prod/AppBeta/mongo-VTqmA0:MONGO_USERNAME::"
                },
                {
                    "name": "MONGO_PASSWORD",
                    "valueFrom": "arn:aws:secretsmanager:ap-northeast-2:901512289056:secret:prod/AppBeta/mongo-VTqmA0:MONGO_PASSWORD::"
                }
            ],
            "logConfiguration": {
                "logDriver": "awslogs",
                "options": {
                    "awslogs-create-group": "true",
                    "awslogs-group": "/ecs/helloworld-was-td",
                    "awslogs-region": "ap-northeast-2",
                    "awslogs-stream-prefix": "ecs"
                }
            }
        }
    ],
    "family": "helloworld-was-td",
    "taskRoleArn": "arn:aws:iam::901512289056:role/ecsTaskExecutionRole",
    "executionRoleArn": "arn:aws:iam::901512289056:role/ecsTaskExecutionRole",
    "networkMode": "awsvpc",
    "revision": 2,
    "volumes": [],
    "status": "ACTIVE",
    "requiresAttributes": [
        {
            "name": "com.amazonaws.ecs.capability.logging-driver.awslogs"
        },
        {
            "name": "ecs.capability.execution-role-awslogs"
        },
        {
            "name": "com.amazonaws.ecs.capability.ecr-auth"
        },
        {
            "name": "com.amazonaws.ecs.capability.docker-remote-api.1.19"
        },
        {
            "name": "ecs.capability.secrets.asm.environment-variables"
        },
        {
            "name": "com.amazonaws.ecs.capability.task-iam-role"
        },
        {
            "name": "ecs.capability.execution-role-ecr-pull"
        },
        {
            "name": "com.amazonaws.ecs.capability.docker-remote-api.1.18"
        },
        {
            "name": "ecs.capability.task-eni"
        },
        {
            "name": "com.amazonaws.ecs.capability.docker-remote-api.1.29"
        }
    ],
    "placementConstraints": [],
    "compatibilities": [
        "EC2",
        "FARGATE"
    ],
    "requiresCompatibilities": [
        "FARGATE"
    ],
    "cpu": "1024",
    "memory": "3072",
    "runtimePlatform": {
        "cpuArchitecture": "X86_64",
        "operatingSystemFamily": "LINUX"
    },
    "registeredAt": "2023-01-25T03:32:36.441Z",
    "registeredBy": "arn:aws:iam::901512289056:user/Administrator",
    "tags": [
        {
            "key": "ecs:taskDefinition:createdFrom",
            "value": "ecs-console-v2"
        }
    ]
}
```

**2️⃣ workflow 추가**
  
```yml
$ vim .github/workflows/aws.yml
# This workflow will build and push a new container image to Amazon ECR,
# and then will deploy a new task definition to Amazon ECS, when there is a push to the "main" branch.
#
# To use this workflow, you will need to complete the following set-up steps:
#
# 1. Create an ECR repository to store your images.
#    For example: `aws ecr create-repository --repository-name my-ecr-repo --region us-east-2`.
#    Replace the value of the `ECR_REPOSITORY` environment variable in the workflow below with your repository's name.
#    Replace the value of the `AWS_REGION` environment variable in the workflow below with your repository's region.
#
# 2. Create an ECS task definition, an ECS cluster, and an ECS service.
#    For example, follow the Getting Started guide on the ECS console:
#      https://us-east-2.console.aws.amazon.com/ecs/home?region=us-east-2#/firstRun
#    Replace the value of the `ECS_SERVICE` environment variable in the workflow below with the name you set for the Amazon ECS service.
#    Replace the value of the `ECS_CLUSTER` environment variable in the workflow below with the name you set for the cluster.
#
# 3. Store your ECS task definition as a JSON file in your repository.
#    The format should follow the output of `aws ecs register-task-definition --generate-cli-skeleton`.
#    Replace the value of the `ECS_TASK_DEFINITION` environment variable in the workflow below with the path to the JSON file.
#    Replace the value of the `CONTAINER_NAME` environment variable in the workflow below with the name of the container
#    in the `containerDefinitions` section of the task definition.
#
# 4. Store an IAM user access key in GitHub Actions secrets named `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`.
#    See the documentation for each action used below for the recommended IAM policies for this IAM user,
#    and best practices on handling the access key credentials.

name: Deploy to Amazon ECS

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  AWS_REGION: ap-northeast-2                   # set this to your preferred AWS region, e.g. us-west-1
  ECR_REPOSITORY: helloworld-was           # set this to your Amazon ECR repository name
  ECS_SERVICE: helloworld-was-svc                 # set this to your Amazon ECS service name
  ECS_CLUSTER: helloworld-was-cluster                 # set this to your Amazon ECS cluster name
  ECS_TASK_DEFINITION: .aws/task-definition.json # set this to the path to your Amazon ECS task definition
                                               # file, e.g. .aws/task-definition.json
  CONTAINER_NAME: helloworld-was-container         # set this to the name of the container in the
                                               # containerDefinitions section of your task definition

permissions:
  contents: read

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    environment: production

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Extrack version name
      id: extrack_version_name
      run: echo "##[set-output name=version;]$(echo '${{ github.event.head_commit.message }}' | egrep -o '[0-9]{1}\.[0-9]{1}')"

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ${{ env.AWS_REGION }}

    - name: Login to Amazon ECR
      id: login-ecr
      uses: aws-actions/amazon-ecr-login@v1

    - name: Build, tag, and push image to Amazon ECR
      id: build-image
      env:
        ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        IMAGE_TAG: ${{ steps.extrack_version_name.outputs.version }}
      run: |
        # Build a docker container and
        # push it to ECR so that it can
        # be deployed to ECS.
        docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG .
        docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
        echo "image=$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG" >> $GITHUB_OUTPUT

    - name: Fill in the new image ID in the Amazon ECS task definition
      id: task-def
      uses: aws-actions/amazon-ecs-render-task-definition@v1
      with:
        task-definition: ${{ env.ECS_TASK_DEFINITION }}
        container-name: ${{ env.CONTAINER_NAME }}
        image: ${{ steps.build-image.outputs.image }}

    - name: Deploy Amazon ECS task definition
      uses: aws-actions/amazon-ecs-deploy-task-definition@v1
      with:
        task-definition: ${{ steps.task-def.outputs.task-definition }}
        service: ${{ env.ECS_SERVICE }}
        cluster: ${{ env.ECS_CLUSTER }}
        wait-for-service-stability: true
```

</div>
</details>

## 마일스톤6 - 서버 애플리케이션의 HTTPS 적용
<details>
<summary>1. 인증서 발급</summary>
<div markdown="1">       

**1️⃣ 인증서 발급 및 CNAME 생성**
  
![image](https://user-images.githubusercontent.com/87158339/214475445-927223db-6add-4e76-8101-b53021347a29.png){: width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214475502-9a333338-a2ae-47a2-9bd0-eacaf4f73d9d.png){:width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214475654-bb4c68cb-ae8e-49d8-b644-74211d26b2fe.png){: width="700" heigth="700"}

**2️⃣ alb에 대한 도메인 레코드 추가**
  
![image](https://user-images.githubusercontent.com/87158339/214475800-c364532c-2f93-48cb-a048-884606bc57d5.png){: width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214476439-128b5f86-6660-41d8-b6e4-8dc55a883d78.png){: width="700" heigth="700"}

**3️⃣ alb 리스너 추가**
  
![image](https://user-images.githubusercontent.com/87158339/214476607-35ce3307-385a-4b1f-8618-ffbd26362972.png){: width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214476677-88cc419c-3857-4c3b-8598-519fe69dbaf1.png){: width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214476725-45103e7f-0761-4dca-a1c8-946550072ed0.png){: width="700" heigth="700"}

![image](https://user-images.githubusercontent.com/87158339/214476776-3b44c53f-0291-417b-99a1-46e9fa5ad999.png){: width="700" heigth="700"}

</div>
</details>

## 마일스톤7 - 프론트엔드 배포 자동화
<details>
<summary>1. repository fork && clone</summary>
<div markdown="1">       

```bash
$ git clone git@github.com:gangdonguri/project2-frontend.git
$ cd project2-frontend
```

</div>
</details>

<details>
<summary>2. package.json 파일 수정</summary>
<div markdown="1">       

```bash
$ vim package.json
 16   "scripts": {
 17     "start": "PORT=4000 REACT_APP_ENDPOINT=https://api.devops03-gg.click react-scripts start",
 18     "build": "REACT_APP_ENDPOINT=https://api.devops03-gg.click react-scripts build",

# REACE_APP_ENDPOINT = alb 로드밸런서 주소
```

</div>
</details>

<details>
<summary>3. buildspec.yml 파일 생성</summary>
<div markdown="1">       

```yml
version: 0.2

phases:
  pre_build:
    commands:
      - npm install
  build:
    commands:
      - npm run build

artifacts:
  files:
    - '**/*'
  base-directory: build

$ git add .
$ git commit -m "[MODIFIED] buildspec.yml 추가 && package.json 수정"
$ git remote rename origin myrepo
$ git push myrepo master
```

</div>
</details>

<details>
<summary>4. codepipeline 생성</summary>
<div markdown="1">       

**1️⃣ 파이프라인 설정**
  
![image](https://user-images.githubusercontent.com/87158339/214477773-84bbc799-00bc-49ff-bf2f-523cf1405a8f.png){: width="700" heigth="700"}

**2️⃣ 소스 추가**
  
![image](https://user-images.githubusercontent.com/87158339/214477999-5c817ee1-a7b6-4655-bab1-62f5ac005989.png){: width="700" heigth="700"}

**3️⃣ 빌드 스테이지 추가**
  
![image](https://user-images.githubusercontent.com/87158339/214478408-3bab079a-8093-4465-944d-4e84dde3a8f4.png){: width="700" heigth="700"}

**4️⃣ 배포 스테이지 추가**
  
![image](https://user-images.githubusercontent.com/87158339/214478553-224a578b-d971-4961-8e1b-0b0027e12bcc.png){: width="700" heigth="700"}

</div>
</details>

## 마일스톤8 - 프론트엔드 HTTPS 적용
<details>
<summary>1. 인증서 발급 (us-east-1)</summary>
<div markdown="1">       
  
![image](https://user-images.githubusercontent.com/87158339/214479670-2beae8a6-d905-4417-973f-b2488f5fc1ec.png){: width="700"}

![image](https://user-images.githubusercontent.com/87158339/214479768-8f17d2de-3ed2-4ca7-a52a-0e06e49f0c62.png){: width="700"}

</div>
</details>

<details>
<summary>2. CloudFront 생성</summary>
<div markdown="1">       

**1️⃣ 배포 생성**
  
![image](https://user-images.githubusercontent.com/87158339/214479925-81efe4e9-5ecd-4e9d-8475-8377331b8174.png){: width="700"}

![image](https://user-images.githubusercontent.com/87158339/214480094-11cf5bbd-e7d2-4f9b-8897-92f099b09ff0.png){: width="700"}

![image](https://user-images.githubusercontent.com/87158339/214481165-ea02e35c-3d77-439a-9174-7d97c766e3d5.png){: width="700"}

![image](https://user-images.githubusercontent.com/87158339/214481226-26d658e3-891b-44c9-97fa-b7005c416fb2.png){: width="700"}

**2️⃣ 사용자 정의 오류페이지 생성**
  
![image](https://user-images.githubusercontent.com/87158339/214481440-d69e0902-5265-4b00-b1a5-8d7bb249aaaf.png){: width="700"}

![image](https://user-images.githubusercontent.com/87158339/214481488-35cc20c5-b827-4f99-9da2-cc9a056fc50f.png){: width="700"}

</div>
</details>

<details>
<summary>3. route53 레코드 생성</summary>
<div markdown="1">       

![image](https://user-images.githubusercontent.com/87158339/214479831-da488d23-b09b-40bd-8172-ec3996b8e672.png){: width="700"}

![image](https://user-images.githubusercontent.com/87158339/214480307-b8b85a27-f4a9-4017-943b-83a043292619.png){: width="700"}

![image](https://user-images.githubusercontent.com/87158339/214481545-7899ef3b-210b-4ba2-9708-e51fed4e1929.png){: width="700"}

</div>
</details>

## 마일스톤9 - 프론트엔드 서버 연결 확인
<details>
<summary>1. API 작성</summary>
<div markdown="1">       

```bash
# -------------- WAS 서버에서 진행 ---------------
$ mkdir -p routes/api/restaurants/
$ vim routes/api/restaurants/index.js
'use strict'

module.exports = async function (fastify, opts) {
  fastify.get('/', async function (req, reply) {
    reply.send([
      {
        "name": "용다방",
        "menu": [
          {
            "name": "애플 시나몬 에이드",
            "price": 6500,
            "duration": 5
          },
          {
            "name": "카페모카",
            "price": 6000,
            "duration": 5
          }
        ],
        "address": "서울시 마포구 양화로 1111",
        "rating": 4.5
      }
    ])
  })
}
```

</div>
</details>

<details>
<summary>2. cors 설정</summary>
<div markdown="1">       

```bash
$ vim plugins/cors.js
'use strict'

const fp = require('fastify-plugin')

module.exports = fp(async function (fastify, opts) {
  fastify.register(require('@fastify/cors'))
})
$ vim package.json
{
  "name": "helloworld-was",
  "version": "1.0.0",
  "description": "This project was bootstrapped with Fastify-CLI.",
  "main": "app.js",
  "directories": {
    "test": "test"
  },
  "scripts": {
    "test": "tap \"test/**/*.test.js\"",
    "start": "fastify start -l info app.js --address 0.0.0.0",
    "dev": "fastify start -w -l info -P app.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "fastify": "^4.0.0",
    "fastify-plugin": "^4.0.0",
    "@fastify/autoload": "^5.0.0",
    "@fastify/sensible": "^5.0.0",
    "@fastify/mongodb": "^6.2.0",
    "@fastify/cors": "^8.2.0",
    "fastify-cli": "^5.7.1"
  },
  "devDependencies": {
    "tap": "^16.1.0"
  }
}

$ git add .
$ git commit -m "[TEST] cors 설정 v1.3"
$ git push myrepo main
```

</div>
</details>

## 마일스톤10 - 서버 애플리케이션 CRUD 구현
<details>
<summary>1. 로컬 테스트로 전환</summary>
<div markdown="1">     

```bash
# TODO 1. frontend 프로젝트의 package.json 파일에서 REACE_APP_ENDPOINT를 localhost로 변경 후 frontend docker image 빌드
$ cd project2-frontend
$ docker build -t frontend:1.1 .
$ docker images
REPOSITORY     TAG     IMAGE ID       CREATED          SIZE
frontend       1.1     a0cb22a5c071   5 minutes ago    367MB

# TODO 2. was 프로젝트의 .env 파일에서 MONGO_HOSTNAME을 mongo로 변경
$ cd helloworld
$ vim .env
MONGO_USERNAME="root"
MONGO_PASSWORD="example"
MONGO_HOSTNAME="mongo"

# TODO 3. docker-compose.yml 파일 수정
$ vim docker-compose.yml
version: '3.1'

services:
  frontend:
    image: frontend:1.1
    restart: always
    ports:
      - 4000:4000

  api:
    image: helloworld-was:1.1
    restart: always
    ports:
      - 3000:3000
    volumes:
      - ./:/app
    depends_on:
      - mongo

  mongo:
    image: mongo:4.4
    restart: always
    ports:
      - 27017:27017
    volumes:
      - /data/db:/data/db
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example

# mongo 서비스에서는 데이터 영속성을 위해 바인드 마운트 유형의 볼륨을 연결
# api 서비스에서는 소스 수정 후 컨테이너에 즉각 반영을 위해 바인드 마운트 유형의 볼륨을 연결
```

</div>
</details>

<details>
<summary>2. mongosh를 이용해 collection을 생성하고 데이터 import</summary>
<div markdown="1">       

```js
/*
 데이터베이스를 먼저 생성해야 합니다.
 mongosh에서 다음을 입력하세요.
*/

/* use baedal */

db.createCollection('customer')
const customers = db.customer.insertMany([
  {"username":"김개발","address":"부산광역시 수영구 민락로 100번길"},
  {"username":"최운영","address":"서울시 마포구 양화로 777"}
])

db.createCollection('restaurants')
const menu1 = ObjectId()
const menu2 = ObjectId()
const restaurants = db.restaurants.insertMany([
  {
    "name": "용다방",
    "menu": [
      {
        "_id": ObjectId(),
        "name": "애플 시나몬 에이드",
        "price": 6500,
        "duration": 5
      },
      {
        "_id": ObjectId(),
        "name": "카페모카",
        "price": 6000,
        "duration": 5
      }
    ],
    "address": "서울시 마포구 양화로 1111",
    "rating": 4.5
  },
  {
    "name": "피프",
    "menu": [
      {
        "_id": ObjectId(),
        "name": "에스프레소",
        "price": 2000,
        "duration": 5
      },
      {
        "_id": ObjectId(),
        "name": "스트라파차토",
        "price": 2500,
        "duration": 5
      },
      {
        "_id": ObjectId(),
        "name": "크로플",
        "price": 3000,
        "duration": 10
      }
    ],
    "address": "서울시 마포구 성미산로 4444",
    "rating": 5
  },
  {
    "name": "동백커피",
    "menu": [
      {
        "_id": menu1,
        "name": "동백커피",
        "price": 4000,
        "duration": 10
      },
      {
        "_id": menu2,
        "name": "아인슈페너",
        "price": 4500,
        "duration": 10
      }
    ],
    "address": "부산시 수영구 센텀1로 777",
    "rating": 4.8
  },
  {
    "name": "미포 대구탕",
    "menu": [
      {
        "_id": ObjectId(),
        "name": "대구탕",
        "price": 10000,
        "duration": 20
      },
      {
        "_id": ObjectId(),
        "name": "알말이",
        "price": 6000,
        "duration": 20
      }
    ],
    "address": "부산시 해운대구 미포로 61",
    "rating": 4.5
  }
])

db.createCollection('courier')
const couriers = db.courier.insertMany([
  {"courier":"최배달","location":"35.169161,129.132079","available":false},
  {"courier":"박배송","location":"37.550806,126.903781","available":true}
])

db.createCollection('order')
db.order.insertMany([
  {
    "deliveryInfo": {
      "status":"preparing",
      "assignedCourier":"박배송",
      "estimatedDeleveryTime":40
    },
    "consumer_id": customers.insertedIds[0],
    "restaurant": {
      "name": "동백커피",
      "address": "부산시 수영구 센텀1로 777"
    },
    "orderedMenu":[
      {
        "name": "동백커피",
        "price": 4000,
        "quantity": 3
      },
      {
        "name": "아인슈페너",
        "price": 4500,
        "quantity": 2
      },
    ]
  }
])

db.createCollection('review')
db.review.insertMany([
  {
    "comment":"커피가 아주 일품이예요.","rating":4.5,"reply":"고객님 감사합니다. 더 좋은 커피로 보답하겠습니다.",
    "consumer_id": customers.insertedIds[0]
  }
])
```

</div>
</details>

<details>
<summary>3. 매장 목록 조회 기능 구현</summary>
<div markdown="1">       

**1️⃣ API 명세**
- Request 
  - `Method`: GET
  - `Path`: /api/restaurants
  - `Parameters`: ' '
  - `Body`: ' '
- Responses
  - `Code`: 200 OK
  - `Content-type`: application/json
  - `Example Value`:
  
```json
[
  {
    "_id": "62374c64e5bfa293bf21831b",
    "name": "동백커피 센텀점",
    "menu": [
      {
        "_id": "62374fe0e5bfa293bf218347",
        "name": "동백커피",
        "price": 4000,
        "quantity": 1
      }
    ],
    "address": "부산시 수영구 센텀1로 777",
    "rating": 4.8
  }
]
```

**2️⃣ 기능 구현**
```js
$ vim routes/api/restaurants/index.js
'use strict'

module.exports = async function (fastify, opts) {
  fastify.get('/', async function (req, reply) {
    const baedal = this.mongo.client.db('baedal')
    const restaurant = baedal.collection('restaurants')
    const result = await restaurant.find({}).toArray()

    console.log(result)

    reply
      .code(200)
      .header('content-type', 'application/json')
      .send(result)

      }
  )
}
```

</div>
</details>

<details>
<summary>4. 모든 주문 내역 조회 기능 구현</summary>
<div markdown="1">       

**1️⃣ API 명세**
- Request 
  - `Method`: GET
  - `Path`: /api/orders
  - `Parameters`: ' '
  - `Body`: ' '
- Responses
  - `Code`: 200 OK
  - `Content-type`: application/json
  - `Example Value`:
  
```json
[
  {
    "_id": "6237521ae5bfa293bf21836e",
    "restaurant": {
      "_id": "62374c64e5bfa293bf21831b",
      "name": "동백커피 센텀점",
      "menu": [
        {
          "_id": "62374fe0e5bfa293bf218347",
          "name": "동백커피",
          "price": 4000,
          "quantity": 1
        }
      ],
      "address": "부산시 수영구 센텀1로 777",
      "rating": 4.8
    },
    "orderedMenu": [
      {
        "_id": "62374fe0e5bfa293bf218347",
        "name": "동백커피",
        "price": 4000,
        "quantity": 1
      }
    ],
    "deliveryInfo": {
      "status": "PREPARING",
      "assignedCourier": "김배달",
      "estimatedDeleveryTime": 40
    }
  }
]
```

**2️⃣ 기능 구현**
```js
  fastify.get('/', async function (req, reply) {
    console.log('-------------------------------------------------------------------')
    const db = this.mongo.client.db('baedal');
    const collectionOfOrders = db.collection('order');
    const collectionOfrestaurants = db.collection('restaurants');
    const orders = await collectionOfOrders.find({}).toArray();
    const restaurants = await collectionOfrestaurants.find({}).toArray();

    let rating;
    let restaurantId;
    let restaurantMenu = [];
    let currentOrderedMenu = [];
    let result = [];

    for (let order of orders) {
      for (let restaurant of restaurants) {
        if (order.restaurant.name === restaurant.name) {
          restaurantId = restaurant._id;
          rating = restaurant.rating;
          for (let i = 0; i < restaurant.menu.length; i++) {
            restaurantMenu.push(restaurant.menu[i])
          }
        }
      }

      for (let i = 0; i < order.orderedMenu.length; i++) {
        currentOrderedMenu.push(order.orderedMenu[i])
      }
      
      result.push(
        {
          "_id": `${order._id}`,
          "restaurant": {
            "_id": `${restaurantId}`,
            "name": `${order.restaurant.name}`,
            "menu": restaurantMenu,
            "address": `${order.restaurant.address}`,
            "rating": rating,
          },
          "orderedMenu": currentOrderedMenu,
          "deliveryInfo": order.deliveryInfo
        }
      )
      restaurantMenu = [];
      currentOrderedMenu = [];
    }

    reply
      .code(200)
      .header('content-type', 'application/json')
      .send(result)
    
  })
```

</div>
</details>

<details>
<summary>5. 주문 전송 기능 구현</summary>
<div markdown="1">       

**1️⃣ API 명세**
- Request 
  - `Method`: POST
  - `Path`: /api/orders
  - `Parameters`: ' '
  - `Body`: 

```json
{
  "restaurantId": "62374c64e5bfa293bf21831b",
  "menu": [
    {
      "_id": "62374fe0e5bfa293bf218347",
      "name": "동백커피",
      "price": 4000,
      "quantity": 1
    }
  ]
}
```

- Responses
  - `Code`: 201 OK
  - `Content-type`: application/json
  - `Example Value`:

```json
{
  "_id": "6237521ae5bfa293bf21836e",
  "restaurant": {
    "_id": "62374c64e5bfa293bf21831b",
    "name": "동백커피 센텀점",
    "menu": [
      {
        "_id": "62374fe0e5bfa293bf218347",
        "name": "동백커피",
        "price": 4000,
        "quantity": 1
      }
    ],
    "address": "부산시 수영구 센텀1로 777",
    "rating": 4.8
  },
  "orderedMenu": [
    {
      "_id": "62374fe0e5bfa293bf218347",
      "name": "동백커피",
      "price": 4000,
      "quantity": 1
    }
  ],
  "deliveryInfo": {
    "status": "PREPARING",
    "assignedCourier": "김배달",
    "estimatedDeleveryTime": 40
  }
}
```

**2️⃣ 기능 구현**
```js
  fastify.post('/', async function (req, reply) {
    const courier = ['김배송', '이배송', '박배송', '권배송', '전배송']
    const db = this.mongo.client.db('baedal');
    const collectionOfOrders = db.collection('order');
    const collectionOfrestaurants = db.collection('restaurants');
    const restaurantid = this.mongo.ObjectId(req.body.restaurantId);
    const restaurants = await collectionOfrestaurants.find({ "_id": restaurantid }).toArray();

    const newOrderObjectId = this.mongo.ObjectId();
    const newConsumerObjectId = this.mongo.ObjectId();
    const currentOrdercourier = courier[Math.floor(Math.random() * 5)];
    let restaurantMenu = [];
    let orderedMenu = [];
    let insertOrderMenu = [];

    for (let menu of restaurants[0].menu) {
      restaurantMenu.push(menu);
    }

    for (let menu of req.body.menu) {
      orderedMenu.push(menu);
      delete menu._id;
      insertOrderMenu.push(menu)
    }

    await collectionOfOrders.insertOne(
      {
        "_id": newOrderObjectId,
        "deliveryInfo": {
          "status": "preparing",
          "assignedCourier": currentOrdercourier,
          "estimateDeleveryTime": 40
        },
        "consumer_id": newConsumerObjectId,
        "restaurant": {
          "name": restaurants[0].name,
          "address": restaurants[0].address
        },
        "orderedMenu": insertOrderMenu
      }
    )

    const result = {
      "_id": newOrderObjectId,
      "restaurant": {
        "_id": restaurants[0]._id,
        "name": restaurants[0].name,
        "menu": restaurantMenu,
        "address": restaurants[0].address,
        "rating": restaurants[0].rating
      },
      "orderedMenu": orderedMenu,
      "deliveryInfo": {
        "status": "PREPARING",
        "assignedCourier": "김배달",
        "estimateDeleveryTime": 40
      }
    }

    reply
      .code(201)
      .header('content-type', 'application/json')
      .send(result)

  })
```

</div>
</details>

<details>
<summary>6. 개별 주문 확인 기능 구현</summary>
<div markdown="1">       

**1️⃣ API 명세**
- Request 
  - `Method`: GET
  - `Path`: /api/orders/{id}
  - `Parameters`: {id}
  - `Body`: ' '

- Responses
  - `Code`: 200 OK
  - `Content-type`: application/json
  - `Example Value`:

```json
{
  "_id": "6237521ae5bfa293bf21836e",
  "restaurant": {
    "_id": "62374c64e5bfa293bf21831b",
    "name": "동백커피 센텀점",
    "menu": [
      {
        "_id": "62374fe0e5bfa293bf218347",
        "name": "동백커피",
        "price": 4000,
        "quantity": 1
      }
    ],
    "address": "부산시 수영구 센텀1로 777",
    "rating": 4.8
  },
  "orderedMenu": [
    {
      "_id": "62374fe0e5bfa293bf218347",
      "name": "동백커피",
      "price": 4000,
      "quantity": 1
    }
  ],
  "deliveryInfo": {
    "status": "PREPARING",
    "assignedCourier": "김배달",
    "estimatedDeleveryTime": 40
  }
}
```
**2️⃣ 기능 구현**
```js
  fastify.get('/:id', async function (req, reply) {
    const db = this.mongo.client.db('baedal');
    const collectionOfOrders = db.collection('order');
    const collectionOfrestaurants = db.collection('restaurants');
    const orders = await collectionOfOrders.find({}).toArray();
    const restaurants = await collectionOfrestaurants.find({}).toArray();
    
    let currentOrder;
    let restaurantId;
    let restaurantMenu = [];
    let rating;
    let currentOrderedMenu = [];

    for (let order of orders) {
      if (req.params.id === `${order._id}`) {
        currentOrder = order;
      }
    }

    for (let restaurant of restaurants) {
      if (currentOrder.restaurant.name === restaurant.name) {
        restaurantId = restaurant._id;
        rating = restaurant.rating;
        for (let i = 0; i < restaurant.menu.length; i++) {
          restaurantMenu.push(restaurant.menu[i])
        }
      }
    }

    for (let i = 0; i < currentOrder.orderedMenu.length; i++) {
      currentOrderedMenu.push(currentOrder.orderedMenu[i])
    }

    const result = {
      "_id": `${currentOrder._id}`,
      "restaurant": {
        "_id": `${restaurantId}`,
        "name": `${currentOrder.restaurant.name}`,
        "menu": restaurantMenu,
        "address": `${currentOrder.restaurant.address}`,
        "rating": rating
      },
      "orderedMenu": currentOrderedMenu,
      "deliveryInfo": currentOrder.deliveryInfo
    }

    reply
      .code(200)
      .header('content-type', 'application/json')
      .send(result)

  })
```

</div>
</details>

## 트러블슈팅
1. Dockerfile CMD 명령의 올바르지 못한 형식
- 문제: 
  - `CMD ["npm start"] `
  - -> "npm" 명령과 "start" 파라미터 간에 쉼표로 구분되지 않음 
  - -> 컨테이너에서 foreground로 실행중인 프로세스가 없음 
  - -> 컨테이너는 시작과 동시에 exit됨.
- 해결: 
  - `CMD ["npm, "start"]`
2. was 서버와 mongo 서버 간의 연결 오류
- 문제: 
  - mongo.js 파일에서 mongo HOSTNAME으로 localhost를 바라보고 있었음.
  - was 서버로 생성된 컨테이너에서 mongo와 연결하기 위해 localhost:27017로 SYN를 보냄
  - mongo 서버와 연결 실패로 WAS 컨테이너가 정상적으로 실행되지 않음
- 해결: 
  - mongo.js 파일에서 mongo 서버 HOSTNAME을 docker-copose.yml 파일에 정의한 서비스 이름대로 'mongo'로 변경
3. 테스크에서 secret manager을 통해 생성한 secret 값을 가져오는데 생기는 권한 문제
- 문제:
  - 테스크 정의 생성 시 기본적으로 생성되는 `ecsTaskExecutionRole` Role의 경우 secret 값을 가져올 수 있는 권한이 부여되지 않음.
- 해결:
  - `ecsTaskExecutionRole` Role에 `SecretsManagerReadWrite` 정책을 연결함.
4. cloudfront에서 대체 도메인을 설정하지 않은 경우 발급한 도메인을 통한 접속이 불가능함.
- 문제:
  - cloudfront 생성 시 대체 도메인(CNAME)을 부여하지 않아 www.devops03-gg.click 도메인을 통한 접속이 불가능함.
- 해결:
  - 생성된 cloudfront 에서 설정을 편집하여 대체 도메인 추가
5. mixed contents 오류
- 문제:
  - 유저가 cloudfront에 연결하는데 https 프로토콜을 사용하지만 front에서 WAS 서버의 ENDPOINT를 http 프로토콜로 지정함.
  - 유저에서 WAS 서버로 보내는 추가 요청에 http를 사용하게 됨.
  - 따라서 웹 브라우저에서 mixed content 오류를 발생시킴.
- 해결:
  - front에서 WAS ENDPOINT URI를 수정함(http->https)
6. CloudFront에서 이전 문서에 대한 캐싱으로 업데이트된 최신 문서가 cloudfront에 반영되지 않음.
- 문제:
  - 5번 문제를 해결하고 로컬 테스트에서 정상 작동을 확인하더라도 cloudfront에서는 이전 문서가 캐시되어 있기 때문에 cloudfront로 접속 시 동일한 문제가 발생함.
- 해결:
  - CloudFront 에서 Purge 동작을 통해 캐시된 데이터를 모두 삭제함.

***
    👍 개인 공부 기록용 블로그입니다. 오류나 조언이 있으시면 언제든지 댓글 혹은 메일로 남겨주시면 감사하겠습니다! 😄

[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}